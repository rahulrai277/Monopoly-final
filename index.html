<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ðŸŽ® Monopoly India States - Play Now!</title>
    <style>
        :root {
            --color-primary: #1E3A8A;
            --color-primary-dark: #1E40AF;
            --color-accent: #FBBF24;
            --color-bg: #EFF6FF;
            --color-surface: #DBEAFE;
            --color-text: #1F2937;
            --color-text-secondary: #6B7280;
        }
        
        [data-theme="royal"] {
            --color-primary: #1E3A8A;
            --color-primary-dark: #1E40AF;
            --color-accent: #FBBF24;
            --color-bg: #EFF6FF;
            --color-surface: #DBEAFE;
        }
        
        [data-theme="forest"] {
            --color-primary: #065F46;
            --color-primary-dark: #047857;
            --color-accent: #7DD3FC;
            --color-bg: #ECFDF5;
            --color-surface: #D1FAE5;
        }
        
        [data-theme="sunset"] {
            --color-primary: #EA580C;
            --color-primary-dark: #C2410C;
            --color-accent: #1E40AF;
            --color-bg: #FFF7ED;
            --color-surface: #FFEDD5;
        }
        
        [data-theme="midnight"] {
            --color-primary: #6B21A8;
            --color-primary-dark: #7C3AED;
            --color-accent: #22D3EE;
            --color-bg: #1F2937;
            --color-surface: #374151;
            --color-text: #F9FAFB;
            --color-text-secondary: #D1D5DB;
        }
        
        [data-theme="ocean"] {
            --color-primary: #0891B2;
            --color-primary-dark: #0E7490;
            --color-accent: #FCD34D;
            --color-bg: #ECFEFF;
            --color-surface: #CFFAFE;
        }
        
        [data-theme="sakura"] {
            --color-primary: #EC4899;
            --color-primary-dark: #DB2777;
            --color-accent: #A855F7;
            --color-bg: #FDF2F8;
            --color-surface: #FCE7F3;
        }
        
        [data-theme="cyber"] {
            --color-primary: #10B981;
            --color-primary-dark: #059669;
            --color-accent: #06B6D4;
            --color-bg: #111827;
            --color-surface: #1F2937;
            --color-text: #00FF88;
            --color-text-secondary: #4ADE80;
        }
        
        [data-theme="classic"] {
            --color-primary: #DC2626;
            --color-primary-dark: #B91C1C;
            --color-accent: #059669;
            --color-bg: #FEF2F2;
            --color-surface: #FEE2E2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            background: var(--color-bg);
            color: var(--color-text);
            transition: background 0.5s, color 0.5s;
            -webkit-overflow-scrolling: touch;
        }
        
        /* SETUP PAGE */
        #setupPage {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            animation: float 4s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
        }
        
        .setup-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.95));
            border-radius: 24px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 25px 70px rgba(0,0,0,0.35), 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            z-index: 10;
            animation: slideIn 0.6s ease-out;
            color: #1F2937;
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .setup-title {
            text-align: center;
            font-size: clamp(28px, 6vw, 42px);
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .setup-subtitle {
            text-align: center;
            color: #6B7280;
            margin-bottom: 35px;
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }
        
        .form-group {
            margin-bottom: 28px;
            background: #F9FAFB;
            padding: 20px;
            border-radius: 16px;
            border: 2px solid #F3F4F6;
            transition: all 0.3s;
        }
        
        .form-group:hover {
            border-color: #E5E7EB;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            margin-bottom: 14px;
            color: #1F2937;
            font-size: 15px;
            letter-spacing: 0.8px;
        }
        
        .player-count-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .player-count-btn {
            flex: 1;
            padding: 18px;
            font-size: 22px;
            font-weight: bold;
            border: 3px solid #E5E7EB;
            background: linear-gradient(135deg, white, #F9FAFB);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s;
            color: #6B7280;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-height: 60px;
        }
        
        .player-count-btn:hover {
            border-color: var(--color-primary);
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            background: white;
        }
        
        .player-count-btn.selected {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            border-color: var(--color-primary);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.3);
            transform: translateY(-2px);
        }
        
        .player-inputs {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .player-input-wrapper {
            display: none;
            position: relative;
        }
        
        .player-input-wrapper.active {
            display: block;
        }
        
        .player-input-wrapper[data-player="1"] .player-input {
            border-left: 4px solid #DC2626;
        }
        
        .player-input-wrapper[data-player="2"] .player-input {
            border-left: 4px solid #2563EB;
        }
        
        .player-input-wrapper[data-player="3"] .player-input {
            border-left: 4px solid #059669;
        }
        
        .player-input-wrapper[data-player="4"] .player-input {
            border-left: 4px solid #D97706;
        }
        
        .player-input {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            transition: all 0.3s;
            color: #1F2937;
            background: white;
            font-weight: 500;
        }
        
        .player-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.15);
            transform: translateY(-1px);
        }
        
        .theme-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .theme-btn {
            padding: 16px;
            border: 3px solid #E5E7EB;
            background: linear-gradient(135deg, white, #F9FAFB);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 700;
            color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .theme-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            border-color: var(--color-primary);
        }
        
        .theme-btn.selected {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.25);
        }
        
        .sound-settings {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: white;
            border-radius: 12px;
            border: 2px solid #F3F4F6;
            transition: all 0.3s;
        }
        
        .checkbox-group:hover {
            border-color: #E5E7EB;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 26px;
            height: 26px;
            cursor: pointer;
            accent-color: var(--color-primary);
        }
        
        .checkbox-group label {
            font-size: 16px;
            cursor: pointer;
            flex: 1;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: white;
            border-radius: 12px;
            border: 2px solid #F3F4F6;
        }
        
        .volume-slider {
            flex: 1;
            height: 10px;
            border-radius: 10px;
            background: #E5E7EB;
            outline: none;
            -webkit-appearance: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .volume-value {
            min-width: 50px;
            text-align: right;
            font-weight: 600;
            color: var(--color-primary);
        }
        
        .start-game-btn {
            width: 100%;
            padding: 22px;
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, #10B981, #059669, #047857);
            color: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .start-game-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 10px 35px rgba(16, 185, 129, 0.5);
            background: linear-gradient(135deg, #059669, #047857);
        }
        
        .start-game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid #E5E7EB;
            color: #9CA3AF;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .copyright a {
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .copyright a:hover {
            text-decoration: underline;
        }
        
        /* GAME PAGE */
        #gamePage {
            display: none;
            min-height: 100vh;
            background: var(--color-bg);
        }
        
        #gameHeader {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .game-title {
            font-size: clamp(20px, 4vw, 28px);
            font-weight: bold;
            flex: 1;
            min-width: 200px;
        }
        
        .game-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .control-btn.active {
            background: rgba(255,255,255,0.4);
        }
        
        #themeSelect {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        #gameContent {
            display: grid;
            grid-template-columns: 1fr 400px;
            grid-template-rows: auto auto auto;
            min-height: calc(100vh - 80px);
        }
        
        #boardSection {
            grid-column: 1 / 2;
            grid-row: 1 / 2;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        #board {
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            grid-template-rows: repeat(11, 1fr);
            gap: 2px;
            max-width: 800px;
            width: 100%;
            aspect-ratio: 1;
            background: #333;
            border: 4px solid #333;
            border-radius: 10px;
        }
        
        .space {
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: clamp(7px, 1vw, 11px);
            padding: 3px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .space:hover {
            z-index: 10;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .space-name {
            font-weight: bold;
            text-align: center;
            line-height: 1.1;
            color: #1F2937;
        }
        
        .space-price {
            font-size: 0.8em;
            color: #6B7280;
            margin-top: 2px;
        }
        
        .color-bar {
            width: 100%;
            height: 10px;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .tokens {
            position: absolute;
            bottom: 3px;
            left: 3px;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
        }
        
        .token {
            width: clamp(16px, 2.5vw, 26px);
            height: clamp(16px, 2.5vw, 26px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(10px, 1.5vw, 18px);
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        .token.active {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); box-shadow: 0 4px 16px rgba(255,215,0,0.6); }
        }
        
        .board-center {
            grid-column: 2 / 11;
            grid-row: 2 / 11;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            border-radius: 8px;
            color: white;
            padding: 15px;
        }
        
        .dice-container {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .dice {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: var(--color-primary);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .dice.rolling {
            animation: diceRoll 0.5s ease-in-out;
        }
        
        @keyframes diceRoll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg) scale(1.1); }
        }
        
        .board-title {
            font-size: clamp(16px, 3vw, 24px);
            font-weight: bold;
            text-align: center;
        }
        
        .board-subtitle {
            font-size: clamp(12px, 2vw, 16px);
            opacity: 0.9;
            margin-top: 5px;
        }
        
        /* CENTER DICE SECTION */
        #centerDiceSection {
            grid-column: 1 / 2;
            grid-row: 2 / 3;
            padding: 20px;
            background: var(--color-surface);
            border-top: 3px solid var(--color-primary);
            border-bottom: 3px solid var(--color-primary);
        }
        
        .center-dice-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            border: 3px solid var(--color-primary);
        }
        
        .current-player-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--color-border);
        }
        
        .player-icon {
            font-size: 48px;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        #centerPlayerName {
            font-size: clamp(22px, 4vw, 28px);
            font-weight: bold;
            color: var(--color-primary);
            margin: 0;
        }
        
        .dice-display {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 25px 0;
        }
        
        .dice-item {
            width: 80px;
            height: 80px;
            background: white;
            border: 4px solid var(--color-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            color: var(--color-primary);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }
        
        .dice-item.rolling {
            animation: diceRoll 0.5s ease-in-out;
        }
        
        .player-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 12px;
            background: var(--color-bg);
            border-radius: 12px;
            border: 2px solid var(--color-border);
        }
        
        .stat-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            display: block;
            font-size: 18px;
            font-weight: bold;
            color: var(--color-primary);
        }
        
        .roll-dice-main {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
        }
        
        .roll-dice-main:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.5);
        }
        
        .roll-dice-main:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .roll-icon {
            font-size: 32px;
        }
        
        .status-message {
            text-align: center;
            font-size: 16px;
            color: var(--color-text-secondary);
            font-weight: 600;
            padding: 12px;
            background: var(--color-bg);
            border-radius: 10px;
        }
        
        /* BUY/SELL SECTION */
        #buySellSection {
            grid-column: 1 / 2;
            grid-row: 3 / 4;
            padding: 20px;
            background: var(--color-bg);
        }
        
        .buy-sell-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .section-header {
            font-size: 22px;
            font-weight: bold;
            color: var(--color-primary);
            margin: 0 0 20px 0;
            text-align: center;
        }
        
        .current-space-card {
            background: var(--color-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--color-border);
        }
        
        .info-text {
            text-align: center;
            color: var(--color-text-secondary);
            margin: 0;
            font-size: 15px;
        }
        
        .space-detail-inline {
            text-align: center;
        }
        
        .space-name-big {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-text);
            margin-bottom: 10px;
        }
        
        .space-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .info-item {
            padding: 8px;
            background: white;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .info-label {
            font-weight: 600;
            color: var(--color-text-secondary);
        }
        
        .buy-options {
            margin: 20px 0;
        }
        
        .buy-question {
            font-size: 18px;
            font-weight: bold;
            color: var(--color-text);
            text-align: center;
            margin-bottom: 15px;
        }
        
        .buy-details {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--color-bg);
            border-radius: 10px;
        }
        
        .buy-detail-item {
            text-align: center;
        }
        
        .buy-detail-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }
        
        .buy-detail-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--color-primary);
        }
        
        .buy-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .buy-btn {
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .buy-btn.yes {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }
        
        .buy-btn.no {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
        }
        
        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        .divider-line {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--color-border), transparent);
            margin: 25px 0;
        }
        
        .trade-section {
            text-align: center;
        }
        
        .subsection-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--color-text);
            margin: 0 0 15px 0;
        }
        
        .trade-main-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .trade-main-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        /* RIGHT PANEL */
        #rightPanel {
            grid-column: 2 / 3;
            grid-row: 1 / 4;
            width: 400px;
            background: var(--color-surface);
            border-left: 3px solid var(--color-primary);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: calc(100vh - 80px);
        }
        
        .panel-tabs {
            display: flex;
            background: var(--color-primary);
            border-bottom: 3px solid var(--color-primary-dark);
        }
        
        .panel-tab {
            flex: 1;
            padding: 15px 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        
        .panel-tab:last-child {
            border-right: none;
        }
        
        .panel-tab:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .panel-tab.active {
            background: var(--color-surface);
            color: var(--color-primary);
        }
        
        .panel-content {
            display: none;
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }
        
        .panel-content.active {
            display: block;
        }
        
        .panel-content h2 {
            color: var(--color-primary);
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .player-card {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            color: white;
            border: 3px solid rgba(255,255,255,0.3);
        }
        
        .player-card.active {
            border-width: 4px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            animation: playerGlow 2s infinite;
        }
        
        @keyframes playerGlow {
            0%, 100% { box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
            50% { box-shadow: 0 12px 36px rgba(255,215,0,0.4); }
        }
        
        .player-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
        }
        
        .player-token-display {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            background: rgba(255,255,255,0.2);
            border: 3px solid white;
        }
        
        .player-info h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .player-cash {
            font-size: 18px;
            font-weight: bold;
        }
        
        .property-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        .property-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            border-left: 4px solid white;
        }
        
        .info-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            display: flex;
            gap: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .info-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .card-number {
            width: 32px;
            height: 32px;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .card-content h4 {
            font-size: 14px;
            margin-bottom: 6px;
            color: var(--color-text);
        }
        
        .card-content p {
            font-size: 12px;
            color: var(--color-text-secondary);
            line-height: 1.4;
        }
        
        /* BOTTOM SECTION */
        #bottomSection {
            grid-column: 1 / 3;
            grid-row: 4 / 5;
            background: var(--color-surface);
            border-top: 3px solid var(--color-primary);
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .bottom-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        
        .bottom-box h3 {
            color: var(--color-primary);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        #currentTurnInfo {
            font-size: 16px;
            line-height: 1.8;
        }
        
        #rollDiceBtn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 20px;
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        #rollDiceBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        #rollDiceBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }
        
        .action-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn.buy {
            background: #10B981;
            color: white;
        }
        
        .action-btn.skip {
            background: #EF4444;
            color: white;
        }
        
        .action-btn.build {
            background: #F59E0B;
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        #stateInfoBox {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .state-detail {
            padding: 12px;
            background: var(--color-bg);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .state-detail h4 {
            color: var(--color-primary);
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #E5E7EB;
            font-size: 14px;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        #gameLogBox {
            height: 250px;
            overflow-y: auto;
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            padding: 15px;
            background: var(--color-bg);
        }
        
        .log-entry {
            padding: 8px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid var(--color-primary);
            font-size: 13px;
            animation: logSlide 0.3s;
        }
        
        @keyframes logSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* MOBILE RESPONSIVE */
        @media (max-width: 1024px) {
            #gameContent {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto auto;
            }
            
            #boardSection {
                grid-column: 1 / 2;
                grid-row: 1 / 2;
            }
            
            #centerDiceSection {
                grid-column: 1 / 2;
                grid-row: 2 / 3;
            }
            
            #buySellSection {
                grid-column: 1 / 2;
                grid-row: 3 / 4;
            }
            
            #rightPanel {
                grid-column: 1 / 2;
                grid-row: 4 / 5;
                width: 100%;
                border-left: none;
                border-top: 3px solid var(--color-primary);
                max-height: none;
            }
            
            #bottomSection {
                grid-column: 1 / 2;
                grid-row: 5 / 6;
                grid-template-columns: 1fr;
                padding: 15px;
                gap: 15px;
            }
            
            .bottom-box {
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .center-dice-container {
                padding: 20px;
            }
            
            .player-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .dice-item {
                width: 60px;
                height: 60px;
                font-size: 36px;
            }
            
            .roll-dice-main {
                font-size: 20px;
                padding: 16px;
            }
            
            .buy-sell-container {
                padding: 18px;
            }
            
            .setup-container {
                padding: 25px;
                margin: 10px;
            }
            
            .theme-buttons {
                grid-template-columns: 1fr 1fr;
            }
            
            #gameHeader {
                padding: 15px;
            }
            
            .game-title {
                font-size: 18px;
            }
            
            #boardSection {
                padding: 10px;
            }
            
            .dice {
                width: 45px;
                height: 45px;
                font-size: 26px;
            }
            
            .panel-tab {
                font-size: 12px;
                padding: 14px 10px;
            }
            
            .bottom-box {
                padding: 15px;
            }
            
            .bottom-box h3 {
                font-size: 16px;
            }
            
            #rollDiceBtn {
                padding: 14px;
                font-size: 18px;
                min-height: 56px;
            }
            
            #tradeBtn {
                min-height: 52px;
                font-size: 16px;
            }
            
            .action-btn {
                min-height: 48px;
                font-size: 15px;
            }
        }
        
        /* TRADING MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlide 0.3s ease-out;
            color: #1F2937;
        }
        
        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #E5E7EB;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            color: #6B7280;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            background: #F3F4F6;
            color: #1F2937;
        }
        
        .property-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .property-trade-item {
            background: #F9FAFB;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #E5E7EB;
            transition: all 0.3s;
        }
        
        .property-trade-item:hover {
            border-color: var(--color-primary);
            transform: translateX(5px);
        }
        
        .property-trade-info {
            flex: 1;
        }
        
        .property-trade-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
            color: #1F2937;
        }
        
        .property-trade-price {
            color: #6B7280;
            font-size: 14px;
        }
        
        .trade-buttons {
            display: flex;
            gap: 8px;
        }
        
        .trade-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .trade-btn.sell {
            background: #F59E0B;
            color: white;
        }
        
        .trade-btn.buy {
            background: #10B981;
            color: white;
        }
        
        .trade-btn.offer {
            background: #3B82F6;
            color: white;
        }
        
        .trade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #E5E7EB, transparent);
            margin: 25px 0;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--color-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .player-properties-section {
            margin-bottom: 20px;
        }
        
        .player-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 12px;
        }
        
        .price-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        
        .price-input-group label {
            font-weight: 600;
            color: #374151;
        }
        
        .price-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #E5E7EB;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .price-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        
        .price-suggestion {
            font-size: 13px;
            color: #6B7280;
            font-style: italic;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-btn.primary {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }
        
        .modal-btn.secondary {
            background: #E5E7EB;
            color: #374151;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #6B7280;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #E5E7EB;
            font-size: 14px;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .ai-thinking {
            animation: aiPulse 1.5s infinite;
        }
        
        @keyframes aiPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .validation-error {
            background: #FEE2E2;
            border: 2px solid #EF4444;
            color: #DC2626;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
            text-align: center;
        }
        
        .validation-success {
            background: #D1FAE5;
            border: 2px solid #10B981;
            color: #059669;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
            text-align: center;
        }
        
        @media (max-width: 600px) {
            .setup-container {
                padding: 20px;
                margin: 5px;
            }
            
            .form-group {
                padding: 15px;
            }
            
            .player-count-buttons {
                gap: 8px;
            }
            
            .player-count-btn {
                padding: 14px;
                font-size: 20px;
                min-height: 54px;
            }
            
            .theme-buttons {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .current-player-header {
                flex-direction: column;
            }
            
            .player-icon {
                font-size: 36px;
                width: 60px;
                height: 60px;
            }
            
            #centerPlayerName {
                font-size: 20px;
            }
            
            .dice-item {
                width: 50px;
                height: 50px;
                font-size: 28px;
            }
            
            .roll-dice-main {
                font-size: 18px;
                padding: 14px;
            }
            
            .buy-buttons {
                grid-template-columns: 1fr;
            }
            
            .space-info-grid {
                grid-template-columns: 1fr;
            }
            
            .setup-container {
                padding: 18px;
            }
            
            .setup-title {
                font-size: 24px;
            }
            
            .setup-subtitle {
                font-size: 14px;
            }
            
            .modal-content {
                padding: 18px;
            }
            
            .trade-buttons {
                flex-direction: column;
            }
            
            .trade-btn {
                width: 100%;
                padding: 12px;
                min-height: 48px;
            }
            
            .player-count-buttons {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
            }
            
            .space {
                font-size: 7px;
                padding: 2px;
            }
            
            .token {
                width: 16px;
                height: 16px;
                font-size: 11px;
            }
            
            .dice {
                width: 38px;
                height: 38px;
                font-size: 22px;
            }
            
            #boardSection {
                padding: 8px;
            }
            
            .panel-tab {
                font-size: 10px;
                padding: 12px 6px;
            }
            
            #gameHeader {
                flex-direction: column;
                align-items: stretch;
            }
            
            .game-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            #rollDiceBtn {
                font-size: 16px;
                padding: 12px;
            }
        }
        
        @media (max-width: 375px) {
            .center-dice-container {
                padding: 15px;
            }
            
            .dice-display {
                gap: 12px;
            }
            
            .roll-icon {
                font-size: 24px;
            }
            
            .setup-container {
                padding: 15px;
            }
            
            .setup-title {
                font-size: 22px;
            }
            
            .player-count-btn {
                font-size: 18px;
                padding: 12px;
                min-height: 50px;
            }
            
            .space {
                font-size: 6px;
                padding: 1px;
            }
            
            .space-name {
                font-size: 0.9em;
            }
            
            .token {
                width: 14px;
                height: 14px;
                font-size: 9px;
                border-width: 1px;
            }
            
            .dice {
                width: 32px;
                height: 32px;
                font-size: 18px;
            }
        }
        
        @media (max-width: 320px) {
            .setup-container {
                padding: 12px;
            }
            
            .setup-title {
                font-size: 20px;
            }
            
            .player-count-btn {
                font-size: 16px;
                padding: 10px;
            }
            
            .theme-btn {
                font-size: 12px;
                padding: 12px;
            }
            
            .start-game-btn {
                font-size: 18px;
                padding: 16px;
            }
            
            .form-label {
                font-size: 12px;
            }
        }
    </style>
</head>
<body data-theme="royal">
    <!-- SETUP PAGE -->
    <div id="setupPage">
        <div class="particles" id="particles"></div>
        <div class="setup-container">
            <div class="setup-title">ðŸ‡®ðŸ‡³ MONOPOLY INDIA STATES</div>
            <div class="setup-subtitle">Build Your Empire Across India</div>
            
            <div class="form-group">
                <label class="form-label" style="justify-content: center;">ðŸŽ® Player Setup</label>
                <div style="margin-bottom: 15px; text-align: center; color: #6B7280; font-size: 14px;">Choose human vs AI players</div>
                <div class="player-count-buttons">
                    <button class="player-count-btn" data-humans="1" data-ai="3">1H + 3AI</button>
                    <button class="player-count-btn" data-humans="2" data-ai="2">2H + 2AI</button>
                    <button class="player-count-btn" data-humans="3" data-ai="1">3H + 1AI</button>
                    <button class="player-count-btn" data-humans="4" data-ai="0">4 Human</button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" style="justify-content: center;">ðŸ¤– AI Difficulty</label>
                <div class="player-count-buttons">
                    <button class="player-count-btn ai-difficulty-btn" data-difficulty="easy">ðŸ˜Š Easy</button>
                    <button class="player-count-btn ai-difficulty-btn" data-difficulty="medium">ðŸŽ¯ Medium</button>
                    <button class="player-count-btn ai-difficulty-btn" data-difficulty="hard">ðŸ”¥ Hard</button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" style="justify-content: center;">ðŸ‘¥ Player Information</label>
                <div class="player-inputs" id="playerInputs">
                    <div class="player-input-wrapper" data-player="1">
                        <input type="text" class="player-input" placeholder="ðŸ›ï¸ Player 1 Name (Red)" maxlength="20">
                    </div>
                    <div class="player-input-wrapper" data-player="2">
                        <input type="text" class="player-input" placeholder="ðŸ˜ï¸ Player 2 Name (Blue)" maxlength="20">
                    </div>
                    <div class="player-input-wrapper" data-player="3">
                        <input type="text" class="player-input" placeholder="ðŸ•Œ Player 3 Name (Green)" maxlength="20">
                    </div>
                    <div class="player-input-wrapper" data-player="4">
                        <input type="text" class="player-input" placeholder="â›©ï¸ Player 4 Name (Orange)" maxlength="20">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" style="justify-content: center;">ðŸŽ¨ Appearance Settings</label>
                <div class="theme-buttons" id="themeButtons">
                    <button class="theme-btn" data-theme="royal">ðŸ‘‘ Royal Blue</button>
                    <button class="theme-btn" data-theme="forest">ðŸŒ² Forest Green</button>
                    <button class="theme-btn" data-theme="sunset">ðŸŒ… Sunset Orange</button>
                    <button class="theme-btn" data-theme="midnight">ðŸŒ™ Midnight Purple</button>
                    <button class="theme-btn" data-theme="ocean">ðŸŒŠ Ocean Teal</button>
                    <button class="theme-btn" data-theme="sakura">ðŸŒ¸ Sakura Pink</button>
                    <button class="theme-btn" data-theme="cyber">ðŸ”® Cyber Neon</button>
                    <button class="theme-btn" data-theme="classic">ðŸŽ² Classic</button>
                </div>
            </div>
            
            <div class="form-group" style="margin-bottom: 30px;">
                <label class="form-label" style="justify-content: center;">ðŸ”Š Sound Settings</label>
                <div class="sound-settings">
                    <div class="checkbox-group">
                        <input type="checkbox" id="bgMusicToggle" checked>
                        <label for="bgMusicToggle">ðŸŽµ Background Music</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="soundEffectsToggle" checked>
                        <label for="soundEffectsToggle">ðŸ”Š Sound Effects</label>
                    </div>
                    <div class="volume-control">
                        <label>ðŸ”Š Volume:</label>
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
                        <span class="volume-value" id="volumeValue">50%</span>
                    </div>
                </div>
            </div>
            
            <button class="start-game-btn" id="startGameBtn" disabled>ðŸŽ® START GAME</button>
            
            <div class="copyright">
                Â© 2025 <strong>Rahul Rai</strong><br>
                <a href="https://portfolio.rahulrai.com" target="_blank">View Portfolio</a>
            </div>
        </div>
    </div>
    
    <!-- GAME PAGE -->
    <div id="gamePage">
        <!-- HEADER -->
        <div id="gameHeader">
            <div class="game-title">ðŸ‡®ðŸ‡³ MONOPOLY INDIA STATES</div>
            <div class="game-controls">
                <button class="control-btn" id="saveGameBtn">ðŸ’¾ Save</button>
                <button class="control-btn" id="loadGameBtn">ðŸ“‚ Load</button>
                <button class="control-btn" id="settingsBtn">âš™ï¸ Settings</button>
                <button class="control-btn active" id="soundBtn">ðŸ”Š Sound</button>
                <button class="control-btn active" id="musicBtn">ðŸŽµ Music</button>
                <select id="themeSelect">
                    <option value="royal">ðŸ‘‘ Royal Blue</option>
                    <option value="forest">ðŸŒ² Forest Green</option>
                    <option value="sunset">ðŸŒ… Sunset Orange</option>
                    <option value="midnight">ðŸŒ™ Midnight Purple</option>
                    <option value="ocean">ðŸŒŠ Ocean Teal</option>
                    <option value="sakura">ðŸŒ¸ Sakura Pink</option>
                    <option value="cyber">ðŸ”® Cyber Neon</option>
                    <option value="classic">ðŸŽ² Classic</option>
                </select>
            </div>
        </div>
        
        <div id="gameContent">
            <!-- BOARD SECTION -->
            <div id="boardSection">
                <div id="board">
                    <!-- Board spaces will be generated by JS -->
                </div>
            </div>
            
            <!-- CENTER DICE SECTION -->
            <div id="centerDiceSection">
                <div class="center-dice-container">
                    <div class="current-player-header">
                        <div class="player-icon" id="centerPlayerIcon">ðŸ›ï¸</div>
                        <h2 id="centerPlayerName">Player 1's Turn</h2>
                    </div>
                    
                    <div class="dice-display">
                        <div class="dice-item" id="centerDice1">1</div>
                        <div class="dice-item" id="centerDice2">1</div>
                    </div>
                    
                    <div class="player-stats">
                        <div class="stat-item">
                            <span class="stat-label">Last Roll:</span>
                            <span class="stat-value" id="centerLastRoll">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Cash:</span>
                            <span class="stat-value" id="centerCash">$1,500</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Position:</span>
                            <span class="stat-value" id="centerPosition">GO</span>
                        </div>
                    </div>
                    
                    <button class="roll-dice-main" id="rollDiceMainBtn">
                        <span class="roll-icon">ðŸŽ²</span>
                        <span class="roll-text">ROLL DICE</span>
                    </button>
                    
                    <div class="status-message" id="statusMessage">Click to roll the dice!</div>
                </div>
            </div>
            
            <!-- BUY/SELL SECTION -->
            <div id="buySellSection">
                <div class="buy-sell-container">
                    <h3 class="section-header">Decision Panel</h3>
                    
                    <div id="currentSpaceInfo" class="current-space-card">
                        <p class="info-text">Roll the dice to begin!</p>
                    </div>
                    
                    <div id="buyOptions" class="buy-options" style="display: none;">
                        <!-- Buy options will be inserted here -->
                    </div>
                    
                    <div class="divider-line"></div>
                    
                    <div class="trade-section">
                        <h4 class="subsection-title">ðŸ¤ Trade &amp; Sell</h4>
                        <button class="trade-main-btn" onclick="openTradeModal()">
                            <span>ðŸ’¼</span> Open Trading Center
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- RIGHT PANEL -->
            <div id="rightPanel">
                <div class="panel-tabs">
                    <button class="panel-tab active" data-panel="players">ðŸ‘¥ Players</button>
                    <button class="panel-tab" data-panel="community">ðŸ“‹ Community</button>
                    <button class="panel-tab" data-panel="chance">ðŸŽ² Chance</button>
                </div>
                
                <div class="panel-content active" id="playersPanel">
                    <h2>ðŸ‘¥ Player Purchases</h2>
                    <div id="playerCards"></div>
                </div>
                
                <div class="panel-content" id="communityPanel">
                    <h2>ðŸ“‹ Community Chest Cards (16)</h2>
                    <div id="communityCards"></div>
                </div>
                
                <div class="panel-content" id="chancePanel">
                    <h2>ðŸŽ² Chance Cards (16)</h2>
                    <div id="chanceCards"></div>
                </div>
            </div>
        </div>
        
        <!-- BOTTOM SECTION -->
        <div id="bottomSection">
            <div class="bottom-box">
                <h3>ðŸ“ State Information</h3>
                <div id="stateInfoBox">
                    <p style="color: #6B7280; text-align: center; padding: 20px;">Roll the dice to begin your journey!</p>
                </div>
            </div>
            
            <div class="bottom-box">
                <h3>ðŸ“œ Game Log</h3>
                <div id="gameLogBox"></div>
            </div>
        </div>
    </div>
    
    <!-- TRADING MODAL -->
    <div class="modal-overlay" id="tradeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ðŸ¤ Trading Center</div>
                <button class="close-modal" onclick="closeTradeModal()">Ã—</button>
            </div>
            
            <div id="tradeContent">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>
    
    <!-- SELL PROPERTY MODAL -->
    <div class="modal-overlay" id="sellModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ðŸ’° Sell Property</div>
                <button class="close-modal" onclick="closeSellModal()">Ã—</button>
            </div>
            
            <div id="sellContent">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>
    
    <!-- OFFER MODAL -->
    <div class="modal-overlay" id="offerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ðŸ“ Make Offer</div>
                <button class="close-modal" onclick="closeOfferModal()">Ã—</button>
            </div>
            
            <div id="offerContent">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>
    
    <!-- SETTINGS MODAL -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">âš™ï¸ Settings</div>
                <button class="close-modal" onclick="closeSettingsModal()">Ã—</button>
            </div>
            <div id="settingsContent">
                <!-- Settings content will be here -->
            </div>
        </div>
    </div>
    
    <!-- SAVE GAME MODAL -->
    <div class="modal-overlay" id="saveModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ðŸ’¾ Save Game</div>
                <button class="close-modal" onclick="closeSaveModal()">Ã—</button>
            </div>
            <div id="saveContent">
                <!-- Save content will be here -->
            </div>
        </div>
    </div>
    
    <!-- LOAD GAME MODAL -->
    <div class="modal-overlay" id="loadModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ðŸ“‚ Load Game</div>
                <button class="close-modal" onclick="closeLoadModal()">Ã—</button>
            </div>
            <div id="loadContent">
                <!-- Load content will be here -->
            </div>
        </div>
    </div>
    
    <!-- STATE INFO MODAL -->
    <div class="modal-overlay" id="stateInfoModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-title" id="stateInfoTitle">State Details</div>
                <button class="close-modal" onclick="closeStateInfoModal()">Ã—</button>
            </div>
            <div id="stateInfoContent">
                <!-- State info content will be here -->
            </div>
        </div>
    </div>
    
    <script>
// ===== GAME DATA =====
const BOARD_SPACES = [
    { name: "GO", type: "corner", price: 0, emoji: "ðŸŽ¯" },
    { name: "Himachal Pradesh", type: "property", price: 60, rent: 2, color: "#8B4513", emoji: "ðŸ”ï¸", region: "North", capital: "Shimla", houses: 0, rentWithHouses: [10, 30, 90, 160, 250], houseCost: 50 },
    { name: "Community Chest", type: "card", price: 0, emoji: "ðŸ“‹", cardType: "community" },
    { name: "Uttarakhand", type: "property", price: 60, rent: 4, color: "#8B4513", emoji: "â›°ï¸", region: "North", capital: "Dehradun", houses: 0, rentWithHouses: [20, 60, 180, 320, 450], houseCost: 50 },
    { name: "Income Tax", type: "tax", price: 0, amount: 200, emoji: "ðŸ’°" },
    { name: "Railway 1", type: "railroad", price: 200, rent: 25, emoji: "ðŸš‚" },
    { name: "Punjab", type: "property", price: 100, rent: 6, color: "#87CEEB", emoji: "ðŸŒ¾", region: "North", capital: "Chandigarh", houses: 0, rentWithHouses: [30, 90, 270, 400, 550], houseCost: 50 },
    { name: "Chance", type: "card", price: 0, emoji: "ðŸŽ²", cardType: "chance" },
    { name: "Haryana", type: "property", price: 100, rent: 6, color: "#87CEEB", emoji: "ðŸ­", region: "North", capital: "Chandigarh", houses: 0, rentWithHouses: [30, 90, 270, 400, 550], houseCost: 50 },
    { name: "Rajasthan", type: "property", price: 120, rent: 8, color: "#87CEEB", emoji: "ðŸ°", region: "North", capital: "Jaipur", houses: 0, rentWithHouses: [40, 100, 300, 450, 600], houseCost: 50 },
    { name: "Jail", type: "corner", price: 0, emoji: "ðŸ”’" },
    { name: "Madhya Pradesh", type: "property", price: 140, rent: 10, color: "#FF69B4", emoji: "ðŸ›•", region: "Central", capital: "Bhopal", houses: 0, rentWithHouses: [50, 150, 450, 625, 750], houseCost: 100 },
    { name: "Utility 1", type: "utility", price: 150, emoji: "ðŸ’¡" },
    { name: "Chhattisgarh", type: "property", price: 140, rent: 10, color: "#FF69B4", emoji: "ðŸŒ³", region: "Central", capital: "Raipur", houses: 0, rentWithHouses: [50, 150, 450, 625, 750], houseCost: 100 },
    { name: "Jharkhand", type: "property", price: 160, rent: 12, color: "#FF69B4", emoji: "â›ï¸", region: "East", capital: "Ranchi", houses: 0, rentWithHouses: [60, 180, 500, 700, 900], houseCost: 100 },
    { name: "Railway 2", type: "railroad", price: 200, rent: 25, emoji: "ðŸš‚" },
    { name: "Odisha", type: "property", price: 180, rent: 14, color: "#FFA500", emoji: "ðŸ–ï¸", region: "East", capital: "Bhubaneswar", houses: 0, rentWithHouses: [70, 200, 550, 750, 950], houseCost: 100 },
    { name: "Community Chest", type: "card", price: 0, emoji: "ðŸ“‹", cardType: "community" },
    { name: "West Bengal", type: "property", price: 180, rent: 14, color: "#FFA500", emoji: "ðŸŽ­", region: "East", capital: "Kolkata", houses: 0, rentWithHouses: [70, 200, 550, 750, 950], houseCost: 100 },
    { name: "Bihar", type: "property", price: 200, rent: 16, color: "#FFA500", emoji: "ðŸ“š", region: "East", capital: "Patna", houses: 0, rentWithHouses: [80, 220, 600, 800, 1000], houseCost: 100 },
    { name: "Free Parking", type: "corner", price: 0, emoji: "ðŸ…¿ï¸" },
    { name: "Uttar Pradesh", type: "property", price: 220, rent: 18, color: "#DC143C", emoji: "ðŸ•Œ", region: "North", capital: "Lucknow", houses: 0, rentWithHouses: [90, 250, 700, 875, 1050], houseCost: 150 },
    { name: "Chance", type: "card", price: 0, emoji: "ðŸŽ²", cardType: "chance" },
    { name: "Assam", type: "property", price: 220, rent: 18, color: "#DC143C", emoji: "ðŸµ", region: "Northeast", capital: "Dispur", houses: 0, rentWithHouses: [90, 250, 700, 875, 1050], houseCost: 150 },
    { name: "Gujarat", type: "property", price: 240, rent: 20, color: "#DC143C", emoji: "ðŸ¦", region: "West", capital: "Gandhinagar", houses: 0, rentWithHouses: [100, 300, 750, 925, 1100], houseCost: 150 },
    { name: "Railway 3", type: "railroad", price: 200, rent: 25, emoji: "ðŸš‚" },
    { name: "Karnataka", type: "property", price: 260, rent: 22, color: "#FFD700", emoji: "ðŸ’»", region: "South", capital: "Bangalore", houses: 0, rentWithHouses: [110, 330, 800, 975, 1150], houseCost: 150 },
    { name: "Telangana", type: "property", price: 260, rent: 22, color: "#FFD700", emoji: "ðŸ’Ž", region: "South", capital: "Hyderabad", houses: 0, rentWithHouses: [110, 330, 800, 975, 1150], houseCost: 150 },
    { name: "Utility 2", type: "utility", price: 150, emoji: "ðŸ’§" },
    { name: "Andhra Pradesh", type: "property", price: 280, rent: 24, color: "#FFD700", emoji: "ðŸŒ¶ï¸", region: "South", capital: "Amaravati", houses: 0, rentWithHouses: [120, 360, 850, 1025, 1200], houseCost: 150 },
    { name: "Go to Jail", type: "corner", price: 0, emoji: "ðŸ‘®" },
    { name: "Tamil Nadu", type: "property", price: 300, rent: 26, color: "#228B22", emoji: "ðŸ›•", region: "South", capital: "Chennai", houses: 0, rentWithHouses: [130, 390, 900, 1100, 1275], houseCost: 200 },
    { name: "Kerala", type: "property", price: 300, rent: 26, color: "#228B22", emoji: "ðŸ¥¥", region: "South", capital: "Trivandrum", houses: 0, rentWithHouses: [130, 390, 900, 1100, 1275], houseCost: 200 },
    { name: "Community Chest", type: "card", price: 0, emoji: "ðŸ“‹", cardType: "community" },
    { name: "Goa", type: "property", price: 320, rent: 28, color: "#228B22", emoji: "ðŸ–ï¸", region: "West", capital: "Panaji", houses: 0, rentWithHouses: [150, 450, 1000, 1200, 1400], houseCost: 200 },
    { name: "Railway 4", type: "railroad", price: 200, rent: 25, emoji: "ðŸš‚" },
    { name: "Chance", type: "card", price: 0, emoji: "ðŸŽ²", cardType: "chance" },
    { name: "Maharashtra", type: "property", price: 350, rent: 35, color: "#0000CD", emoji: "ðŸŒ†", region: "West", capital: "Mumbai", houses: 0, rentWithHouses: [175, 500, 1100, 1300, 1500], houseCost: 200 },
    { name: "Luxury Tax", type: "tax", price: 0, amount: 100, emoji: "ðŸ’Ž" },
    { name: "Delhi", type: "property", price: 400, rent: 50, color: "#0000CD", emoji: "ðŸ›ï¸", region: "North", capital: "New Delhi", houses: 0, rentWithHouses: [200, 600, 1400, 1700, 2000], houseCost: 200 }
];

const COMMUNITY_CHEST_CARDS = [
    { name: "Advance to GO", desc: "Advance to GO. Collect $200.", action: "advanceGo" },
    { name: "Bank Error", desc: "Bank error in your favor. Collect $200.", action: "collect200" },
    { name: "Doctor's Fees", desc: "Doctor's fees. Pay $50.", action: "pay50" },
    { name: "Stock Sale", desc: "From sale of stock you get $50.", action: "collect50" },
    { name: "Get Out of Jail Free", desc: "Get out of Jail Free card.", action: "jailFree" },
    { name: "Go to Jail", desc: "Go to Jail directly.", action: "goJail" },
    { name: "Opera Night", desc: "Grand Opera Night. Collect $50 from every player.", action: "collectAll" },
    { name: "Tax Refund", desc: "Income tax refund. Collect $20.", action: "collect20" },
    { name: "Birthday", desc: "It's your birthday. Collect $10 from every player.", action: "birthday" },
    { name: "Life Insurance", desc: "Life insurance matures. Collect $100.", action: "collect100" },
    { name: "Hospital Fees", desc: "Pay hospital fees of $100.", action: "pay100" },
    { name: "School Fees", desc: "Pay school fees of $50.", action: "paySchool" },
    { name: "Consultancy Fee", desc: "Receive $25 consultancy fee.", action: "collect25" },
    { name: "Street Repairs", desc: "Street repairs: $40 per house, $115 per hotel.", action: "repairs" },
    { name: "Beauty Contest", desc: "Second prize in beauty contest. Collect $10.", action: "collect10" },
    { name: "Inheritance", desc: "You inherit $100.", action: "inherit" }
];

const CHANCE_CARDS = [
    { name: "Advance to GO", desc: "Advance to GO. Collect $200.", action: "advanceGo" },
    { name: "Advance Token", desc: "Advance to nearest railroad.", action: "railroad" },
    { name: "Go Back 3", desc: "Go back 3 spaces.", action: "back3" },
    { name: "Go to Jail", desc: "Go to Jail directly.", action: "goJail" },
    { name: "General Repairs", desc: "$25 per house, $100 per hotel.", action: "repairsGen" },
    { name: "Speeding Fine", desc: "Speeding fine $15.", action: "pay15" },
    { name: "Board Chairman", desc: "Elected chairman. Pay each player $50.", action: "payAll" },
    { name: "Building Loan", desc: "Building loan matures. Collect $150.", action: "collect150" },
    { name: "Bank Dividend", desc: "Bank pays you dividend of $50.", action: "collect50" },
    { name: "Get Out of Jail Free", desc: "Get out of Jail Free card.", action: "jailFree" },
    { name: "Advance to Utility", desc: "Advance to nearest Utility.", action: "utility" },
    { name: "Poor Tax", desc: "Pay poor tax of $15.", action: "poorTax" },
    { name: "Reading Trip", desc: "Take a trip to Reading Railroad.", action: "reading" },
    { name: "Boardwalk", desc: "Advance token to Boardwalk.", action: "boardwalk" },
    { name: "St. Charles", desc: "Advance to St. Charles Place.", action: "stcharles" },
    { name: "Illinois Avenue", desc: "Advance to Illinois Avenue.", action: "illinois" }
];

const PLAYER_COLORS = [
    { bg: "#DC2626", token: "ðŸ›ï¸", name: "Red" },
    { bg: "#2563EB", token: "ðŸ˜ï¸", name: "Blue" },
    { bg: "#059669", token: "ðŸ•Œ", name: "Green" },
    { bg: "#D97706", token: "â›©ï¸", name: "Orange" }
];

let gameState = {
    players: [],
    currentPlayer: 0,
    settings: {
        soundEffects: true,
        bgMusic: true,
        volume: 0.5,
        theme: 'royal',
        aiDifficulty: 'medium',
        showPropertyValues: true,
        showRentAmounts: true,
        confirmBeforeSelling: true,
        confirmBeforeTrading: true,
        animationSpeed: 5
    },
    dice: [1, 1],
    canRoll: true,
    tradeOffers: [],
    aiPlayers: [],
    humanCount: 1,
    gameStartTime: null,
    turnCount: 0,
    aiThinking: false,
    savedGames: {}
};

const AudioContext = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;

function initAudioContext() {
    if (!audioCtx) {
        try {
            audioCtx = new AudioContext();
        } catch (e) {
            console.warn("Web Audio API not supported");
            return null;
        }
    }
    
    if (audioCtx && audioCtx.state === 'suspended') {
        audioCtx.resume().catch(e => {
            console.warn("Could not resume audio context:", e);
        });
    }
    
    return audioCtx;
}

function playSound(type) {
    if (!gameState.settings.soundEffects) return;
    
    if (!audioCtx) {
        audioCtx = initAudioContext();
    }
    
    if (!audioCtx || audioCtx.state === 'suspended') {
        return;
    }
    
    try {
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        const vol = gameState.settings.volume || 0.5;
        
        switch(type) {
            case 'dice':
                osc.frequency.value = 400;
                gain.gain.setValueAtTime(0.3 * vol, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
                break;
            case 'move':
                osc.frequency.value = 300;
                gain.gain.setValueAtTime(0.2 * vol, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                osc.start(now);
                osc.stop(now + 0.15);
                break;
            case 'buy':
                osc.frequency.value = 500;
                gain.gain.setValueAtTime(0.3 * vol, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
                break;
            case 'rent':
                osc.frequency.value = 250;
                gain.gain.setValueAtTime(0.3 * vol, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
                break;
        }
    } catch (e) {
        console.warn("Sound playback error:", e);
    }
}

let musicInterval = null;
function startMusic() {
    if (!gameState.settings.bgMusic) return;
    if (musicInterval) return;
    
    if (!audioCtx) {
        audioCtx = initAudioContext();
    }
    
    if (!audioCtx || audioCtx.state === 'suspended') {
        return;
    }
    
    const playNote = () => {
        if (!gameState.settings.bgMusic || !audioCtx) {
            stopMusic();
            return;
        }
        
        try {
            if (audioCtx.state === 'suspended') {
                return;
            }
            
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            const vol = gameState.settings.volume || 0.5;
            osc.frequency.value = 200 + Math.random() * 100;
            gain.gain.setValueAtTime(0.02 * vol, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
            osc.start(now);
            osc.stop(now + 1.5);
        } catch (e) {
            console.warn("Music error:", e);
        }
    };
    
    musicInterval = setInterval(playNote, 2000);
    playNote();
}

function stopMusic() {
    if (musicInterval) {
        clearInterval(musicInterval);
        musicInterval = null;
    }
}

function initSetup() {
    createParticles();
    
    document.querySelectorAll('.player-count-btn:not(.ai-difficulty-btn)').forEach(btn => {
        btn.addEventListener('click', () => {
            initAudioContext();
            
            document.querySelectorAll('.player-count-btn:not(.ai-difficulty-btn)').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            const humans = parseInt(btn.dataset.humans);
            const ai = parseInt(btn.dataset.ai);
            
            gameState.humanCount = humans;
            gameState.aiPlayers = [];
            for (let i = 0; i < ai; i++) {
                gameState.aiPlayers.push(i + humans);
            }
            
            document.querySelectorAll('.player-input-wrapper').forEach((wrapper, i) => {
                if (i < humans) {
                    wrapper.classList.add('active');
                } else {
                    wrapper.classList.remove('active');
                }
            });
            
            checkStartButton();
        });
    });
    
    document.querySelectorAll('.ai-difficulty-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.ai-difficulty-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            gameState.settings.aiDifficulty = btn.dataset.difficulty;
        });
    });
    
    document.querySelector('.ai-difficulty-btn[data-difficulty="medium"]').classList.add('selected');
    
    document.querySelectorAll('.player-input').forEach(input => {
        input.addEventListener('input', checkStartButton);
    });
    
    document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            const theme = btn.dataset.theme;
            gameState.settings.theme = theme;
            document.body.setAttribute('data-theme', theme);
        });
    });
    
    document.querySelector('.theme-btn[data-theme="royal"]').classList.add('selected');
    
    document.getElementById('bgMusicToggle').addEventListener('change', (e) => {
        gameState.settings.bgMusic = e.target.checked;
    });
    
    document.getElementById('soundEffectsToggle').addEventListener('change', (e) => {
        gameState.settings.soundEffects = e.target.checked;
    });
    
    document.getElementById('volumeSlider').addEventListener('input', (e) => {
        const vol = parseInt(e.target.value);
        gameState.settings.volume = vol / 100;
        document.getElementById('volumeValue').textContent = vol + '%';
    });
    
    document.getElementById('startGameBtn').addEventListener('click', startGame);
}

function checkStartButton() {
    const selectedCount = document.querySelector('.player-count-btn:not(.ai-difficulty-btn).selected');
    if (!selectedCount) {
        document.getElementById('startGameBtn').disabled = true;
        return;
    }
    
    const inputs = Array.from(document.querySelectorAll('.player-input-wrapper.active .player-input'));
    const allFilled = inputs.every(input => input.value.trim() !== '');
    
    document.getElementById('startGameBtn').disabled = !allFilled;
}

function createParticles() {
    const container = document.getElementById('particles');
    for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 4 + 's';
        particle.style.animationDuration = (3 + Math.random() * 2) + 's';
        container.appendChild(particle);
    }
}

function startGame() {
    initAudioContext();
    
    const selectedCount = document.querySelector('.player-count-btn:not(.ai-difficulty-btn).selected');
    const humans = parseInt(selectedCount.dataset.humans);
    const ai = parseInt(selectedCount.dataset.ai);
    
    gameState.players = [];
    const inputs = document.querySelectorAll('.player-input-wrapper.active .player-input');
    
    inputs.forEach((input, i) => {
        gameState.players.push({
            name: input.value.trim(),
            cash: 1500,
            position: 0,
            properties: [],
            color: PLAYER_COLORS[i].bg,
            token: PLAYER_COLORS[i].token,
            colorName: PLAYER_COLORS[i].name,
            isAI: false
        });
    });
    
    for (let i = 0; i < ai; i++) {
        const playerIndex = humans + i;
        gameState.players.push({
            name: `AI ${i + 1} (${gameState.settings.aiDifficulty})`,
            cash: 1500,
            position: 0,
            properties: [],
            color: PLAYER_COLORS[playerIndex].bg,
            token: PLAYER_COLORS[playerIndex].token,
            colorName: PLAYER_COLORS[playerIndex].name,
            isAI: true
        });
    }
    
    gameState.gameStartTime = Date.now();
    
    document.getElementById('setupPage').style.display = 'none';
    document.getElementById('gamePage').style.display = 'block';
    
    initGame();
}

function initGame() {
    document.getElementById('themeSelect').value = gameState.settings.theme;
    
    renderBoard();
    renderInfoCards();
    updateAllDisplays();
    
    document.getElementById('rollDiceMainBtn').addEventListener('click', rollDice);
    
    document.querySelectorAll('.panel-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const panel = tab.dataset.panel;
            document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel-content').forEach(c => c.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(panel + 'Panel').classList.add('active');
        });
    });
    
    document.getElementById('soundBtn').addEventListener('click', (e) => {
        gameState.settings.soundEffects = !gameState.settings.soundEffects;
        e.target.classList.toggle('active', gameState.settings.soundEffects);
        e.target.textContent = gameState.settings.soundEffects ? 'ðŸ”Š Sound' : 'ðŸ”‡ Sound';
    });
    
    document.getElementById('musicBtn').addEventListener('click', (e) => {
        gameState.settings.bgMusic = !gameState.settings.bgMusic;
        e.target.classList.toggle('active', gameState.settings.bgMusic);
        e.target.textContent = gameState.settings.bgMusic ? 'ðŸŽµ Music' : 'ðŸ”‡ Music';
        
        if (gameState.settings.bgMusic) {
            startMusic();
        } else {
            stopMusic();
        }
    });
    
    document.getElementById('themeSelect').addEventListener('change', (e) => {
        gameState.settings.theme = e.target.value;
        document.body.setAttribute('data-theme', e.target.value);
    });
    
    if (gameState.settings.bgMusic) {
        startMusic();
    }
    
    document.getElementById('saveGameBtn').addEventListener('click', openSaveModal);
    document.getElementById('loadGameBtn').addEventListener('click', openLoadModal);
    document.getElementById('settingsBtn').addEventListener('click', openSettingsModal);
    
    updateCurrentTurn();
    updateCurrentSpaceInfo('Click the ROLL DICE button to start!');
    document.getElementById('statusMessage').textContent = 'Ready to roll!';
    
    addLog('ðŸŽ® Game started! ' + gameState.players[0].name + '\'s turn.');
    
    if (gameState.players[0].isAI) {
        setTimeout(() => aiTakeTurn(), 1500);
    }
}

function renderBoard() {
    const board = document.getElementById('board');
    board.innerHTML = '';
    
    const positions = [
        [11,11], [10,11], [9,11], [8,11], [7,11], [6,11], [5,11], [4,11], [3,11], [2,11], [1,11],
        [1,10], [1,9], [1,8], [1,7], [1,6], [1,5], [1,4], [1,3], [1,2], [1,1],
        [2,1], [3,1], [4,1], [5,1], [6,1], [7,1], [8,1], [9,1], [10,1], [11,1],
        [11,2], [11,3], [11,4], [11,5], [11,6], [11,7], [11,8], [11,9], [11,10]
    ];
    
    BOARD_SPACES.forEach((space, index) => {
        const spaceEl = document.createElement('div');
        spaceEl.className = 'space';
        spaceEl.dataset.index = index;
        
        const [col, row] = positions[index];
        spaceEl.style.gridColumn = col;
        spaceEl.style.gridRow = row;
        
        if (space.color) {
            const colorBar = document.createElement('div');
            colorBar.className = 'color-bar';
            colorBar.style.background = space.color;
            spaceEl.appendChild(colorBar);
        }
        
        const name = document.createElement('div');
        name.className = 'space-name';
        name.textContent = space.name;
        spaceEl.appendChild(name);
        
        if (space.price > 0) {
            const price = document.createElement('div');
            price.className = 'space-price';
            price.textContent = '$' + space.price;
            spaceEl.appendChild(price);
        }
        
        const tokens = document.createElement('div');
        tokens.className = 'tokens';
        spaceEl.appendChild(tokens);
        
        spaceEl.addEventListener('click', () => {
            showSpaceInfo(index);
            showSpaceInfoModal(index);
        });
        
        board.appendChild(spaceEl);
    });
    
    const center = document.createElement('div');
    center.className = 'board-center';
    center.innerHTML = `
        <div class="dice-container">
            <div class="dice" id="dice1">1</div>
            <div class="dice" id="dice2">1</div>
        </div>
        <div class="board-title">MONOPOLY</div>
        <div class="board-subtitle">INDIA EDITION</div>
    `;
    board.appendChild(center);
    
    updateTokens();
}

function updateTokens() {
    document.querySelectorAll('.tokens').forEach(el => el.innerHTML = '');
    
    gameState.players.forEach((player, i) => {
        const space = document.querySelector(`.space[data-index="${player.position}"]`);
        if (space) {
            const tokensContainer = space.querySelector('.tokens');
            const token = document.createElement('div');
            token.className = 'token';
            if (i === gameState.currentPlayer) {
                token.classList.add('active');
            }
            token.style.background = player.color;
            token.textContent = player.token;
            tokensContainer.appendChild(token);
        }
    });
}

function renderInfoCards() {
    const communityDiv = document.getElementById('communityCards');
    COMMUNITY_CHEST_CARDS.forEach((card, i) => {
        const cardEl = document.createElement('div');
        cardEl.className = 'info-card';
        cardEl.innerHTML = `
            <div class="card-number">${i + 1}</div>
            <div class="card-content">
                <h4>ðŸ“‹ ${card.name}</h4>
                <p>${card.desc}</p>
            </div>
        `;
        communityDiv.appendChild(cardEl);
    });
    
    const chanceDiv = document.getElementById('chanceCards');
    CHANCE_CARDS.forEach((card, i) => {
        const cardEl = document.createElement('div');
        cardEl.className = 'info-card';
        cardEl.innerHTML = `
            <div class="card-number">${i + 1}</div>
            <div class="card-content">
                <h4>ðŸŽ² ${card.name}</h4>
                <p>${card.desc}</p>
            </div>
        `;
        chanceDiv.appendChild(cardEl);
    });
}

function rollDice() {
    if (!gameState.canRoll) return;
    
    initAudioContext();
    
    gameState.canRoll = false;
    document.getElementById('rollDiceMainBtn').disabled = true;
    document.getElementById('statusMessage').textContent = 'Rolling...';
    
    playSound('dice');
    
    const dice1El = document.getElementById('centerDice1');
    const dice2El = document.getElementById('centerDice2');
    dice1El.classList.add('rolling');
    dice2El.classList.add('rolling');
    
    let count = 0;
    const interval = setInterval(() => {
        dice1El.textContent = Math.floor(Math.random() * 6) + 1;
        dice2El.textContent = Math.floor(Math.random() * 6) + 1;
        count++;
        
        if (count >= 10) {
            clearInterval(interval);
            
            gameState.dice[0] = Math.floor(Math.random() * 6) + 1;
            gameState.dice[1] = Math.floor(Math.random() * 6) + 1;
            const total = gameState.dice[0] + gameState.dice[1];
            
            dice1El.textContent = gameState.dice[0];
            dice2El.textContent = gameState.dice[1];
            dice1El.classList.remove('rolling');
            dice2El.classList.remove('rolling');
            
            const boardDice1 = document.getElementById('dice1');
            const boardDice2 = document.getElementById('dice2');
            if (boardDice1) boardDice1.textContent = gameState.dice[0];
            if (boardDice2) boardDice2.textContent = gameState.dice[1];
            
            addLog(`ðŸŽ² ${gameState.players[gameState.currentPlayer].name} rolled ${gameState.dice[0]} + ${gameState.dice[1]} = ${total}`);
            
            document.getElementById('centerLastRoll').textContent = total;
            
            setTimeout(() => movePlayer(total), 300);
        }
    }, 100);
}

function movePlayer(spaces) {
    const player = gameState.players[gameState.currentPlayer];
    const oldPos = player.position;
    
    let moved = 0;
    const interval = setInterval(() => {
        player.position = (player.position + 1) % 40;
        updateTokens();
        playSound('move');
        moved++;
        
        if (moved >= spaces) {
            clearInterval(interval);
            
            if (player.position < oldPos || (oldPos + spaces >= 40)) {
                player.cash += 200;
                addLog(`ðŸŽ¯ ${player.name} passed GO and collected $200!`);
            }
            
            setTimeout(() => landOnSpace(), 300);
        }
    }, 200);
}

function landOnSpace() {
    const player = gameState.players[gameState.currentPlayer];
    const space = BOARD_SPACES[player.position];
    
    addLog(`ðŸ“ ${player.name} landed on ${space.name}`);
    showSpaceInfo(player.position);
    updateCurrentSpaceInfoCard(player.position);
    
    if (space.type === 'property' || space.type === 'railroad') {
        if (space.owner === undefined || space.owner === null || space.owner === -1) {
            showBuyOption(player.position);
        } else if (space.owner !== gameState.currentPlayer) {
            payRent(player.position);
        } else {
            setTimeout(() => endTurn(), 1000);
        }
    } else if (space.type === 'tax') {
        player.cash -= space.amount;
        addLog(`ðŸ’° ${player.name} paid $${space.amount} in taxes`);
        updateAllDisplays();
        setTimeout(() => endTurn(), 1000);
    } else if (space.type === 'card') {
        drawCard(space.cardType);
    } else {
        setTimeout(() => endTurn(), 1000);
    }
    
    updateAllDisplays();
}

function updateCurrentSpaceInfo(message) {
    const spaceInfoDiv = document.getElementById('currentSpaceInfo');
    spaceInfoDiv.innerHTML = `<p class="info-text">${message}</p>`;
}

function updateCurrentSpaceInfoCard(index) {
    const space = BOARD_SPACES[index];
    const spaceInfoDiv = document.getElementById('currentSpaceInfo');
    
    if (space.type === 'property' || space.type === 'railroad') {
        const owner = space.owner >= 0 ? gameState.players[space.owner].name : 'Available';
        const ownerColor = space.owner >= 0 ? gameState.players[space.owner].color : '#6B7280';
        
        spaceInfoDiv.innerHTML = `
            <div class="space-detail-inline">
                <div class="space-name-big">${space.emoji} ${space.name}</div>
                <div class="space-info-grid">
                    <div class="info-item">
                        <span class="info-label">Type:</span> ${space.type === 'property' ? 'Property' : 'Railroad'}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Price:</span> $${space.price}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Owner:</span> <span style="color: ${ownerColor}; font-weight: bold;">${owner}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Rent:</span> $${space.rent}
                    </div>
                </div>
            </div>
        `;
    } else if (space.type === 'tax') {
        spaceInfoDiv.innerHTML = `
            <div class="space-detail-inline">
                <div class="space-name-big">${space.emoji} ${space.name}</div>
                <p class="info-text" style="margin-top: 10px;">Pay $${space.amount} in taxes</p>
            </div>
        `;
    } else if (space.type === 'card') {
        spaceInfoDiv.innerHTML = `
            <div class="space-detail-inline">
                <div class="space-name-big">${space.emoji} ${space.name}</div>
                <p class="info-text" style="margin-top: 10px;">Draw a ${space.cardType === 'chance' ? 'Chance' : 'Community Chest'} card</p>
            </div>
        `;
    } else {
        spaceInfoDiv.innerHTML = `
            <div class="space-detail-inline">
                <div class="space-name-big">${space.emoji} ${space.name}</div>
            </div>
        `;
    }
}

function showSpaceInfo(index) {
    const space = BOARD_SPACES[index];
    const infoBox = document.getElementById('stateInfoBox');
    
    let html = '';
    
    if (space.type === 'property') {
        const owner = space.owner >= 0 ? gameState.players[space.owner].name : 'Available';
        html = `
            <div class="state-detail">
                <h4>${space.emoji} ${space.name}</h4>
                <div class="detail-row"><span>Region:</span><span>${space.region}</span></div>
                <div class="detail-row"><span>Capital:</span><span>${space.capital}</span></div>
                <div class="detail-row"><span>Price:</span><span>$${space.price}</span></div>
                <div class="detail-row"><span>Owner:</span><span>${owner}</span></div>
            </div>
            <div class="state-detail">
                <h4>ðŸ  Rent Breakdown</h4>
                <div class="detail-row"><span>Base Rent:</span><span>$${space.rent}</span></div>
                <div class="detail-row"><span>1 House:</span><span>$${space.rentWithHouses[0]}</span></div>
                <div class="detail-row"><span>2 Houses:</span><span>$${space.rentWithHouses[1]}</span></div>
                <div class="detail-row"><span>3 Houses:</span><span>$${space.rentWithHouses[2]}</span></div>
                <div class="detail-row"><span>4 Houses:</span><span>$${space.rentWithHouses[3]}</span></div>
                <div class="detail-row"><span>Hotel:</span><span>$${space.rentWithHouses[4]}</span></div>
                <div class="detail-row"><span>House Cost:</span><span>$${space.houseCost}</span></div>
                <div class="detail-row"><span>Buildings:</span><span>${space.houses || 0} ðŸ </span></div>
            </div>
        `;
    } else if (space.type === 'railroad') {
        const owner = space.owner >= 0 ? gameState.players[space.owner].name : 'Available';
        html = `
            <div class="state-detail">
                <h4>ðŸš‚ ${space.name}</h4>
                <div class="detail-row"><span>Type:</span><span>Railroad</span></div>
                <div class="detail-row"><span>Price:</span><span>$${space.price}</span></div>
                <div class="detail-row"><span>Base Rent:</span><span>$${space.rent}</span></div>
                <div class="detail-row"><span>Owner:</span><span>${owner}</span></div>
            </div>
        `;
    } else if (space.type === 'utility') {
        const owner = space.owner >= 0 ? gameState.players[space.owner].name : 'Available';
        html = `
            <div class="state-detail">
                <h4>${space.emoji} ${space.name}</h4>
                <div class="detail-row"><span>Type:</span><span>Utility</span></div>
                <div class="detail-row"><span>Price:</span><span>$${space.price}</span></div>
                <div class="detail-row"><span>Rent:</span><span>4Ã— or 10Ã— dice roll</span></div>
                <div class="detail-row"><span>Owner:</span><span>${owner}</span></div>
            </div>
        `;
    } else {
        html = `
            <div class="state-detail">
                <h4>${space.emoji} ${space.name}</h4>
                <div class="detail-row"><span>Type:</span><span>${space.type}</span></div>
            </div>
        `;
    }
    
    infoBox.innerHTML = html;
}

function showBuyOption(index) {
    const space = BOARD_SPACES[index];
    const player = gameState.players[gameState.currentPlayer];
    
    if (player.isAI) {
        aiDecideBuy(index);
        return;
    }
    
    const buyOptionsDiv = document.getElementById('buyOptions');
    buyOptionsDiv.style.display = 'block';
    
    if (player.cash >= space.price) {
        const afterPurchase = player.cash - space.price;
        buyOptionsDiv.innerHTML = `
            <div class="buy-question">Do you want to buy ${space.name}?</div>
            <div class="buy-details">
                <div class="buy-detail-item">
                    <span class="buy-detail-label">Price</span>
                    <span class="buy-detail-value">$${space.price}</span>
                </div>
                <div class="buy-detail-item">
                    <span class="buy-detail-label">Your Cash</span>
                    <span class="buy-detail-value">$${player.cash}</span>
                </div>
                <div class="buy-detail-item">
                    <span class="buy-detail-label">After Purchase</span>
                    <span class="buy-detail-value">$${afterPurchase}</span>
                </div>
            </div>
            <div class="buy-buttons">
                <button class="buy-btn yes" onclick="buyProperty(${index})">
                    <span>âœ…</span> BUY NOW
                </button>
                <button class="buy-btn no" onclick="skipProperty()">
                    <span>âŒ</span> SKIP
                </button>
            </div>
        `;
    } else {
        buyOptionsDiv.innerHTML = `
            <div class="buy-question" style="color: #EF4444;">Not Enough Cash!</div>
            <div class="buy-details">
                <div class="buy-detail-item">
                    <span class="buy-detail-label">Price</span>
                    <span class="buy-detail-value">$${space.price}</span>
                </div>
                <div class="buy-detail-item">
                    <span class="buy-detail-label">Your Cash</span>
                    <span class="buy-detail-value" style="color: #EF4444;">$${player.cash}</span>
                </div>
            </div>
            <div class="buy-buttons">
                <button class="buy-btn no" onclick="endTurn()" style="grid-column: 1 / -1;">
                    <span>âž¡ï¸</span> CONTINUE
                </button>
            </div>
        `;
    }
}

function buyProperty(index) {
    const space = BOARD_SPACES[index];
    const player = gameState.players[gameState.currentPlayer];
    
    player.cash -= space.price;
    space.owner = gameState.currentPlayer;
    player.properties.push(index);
    
    playSound('buy');
    addLog(`âœ… ${player.name} bought ${space.name} for $${space.price}`);
    
    document.getElementById('buyOptions').style.display = 'none';
    document.getElementById('statusMessage').textContent = `Purchased ${space.name}!`;
    updateAllDisplays();
    
    setTimeout(() => endTurn(), 1000);
}

function skipProperty() {
    const player = gameState.players[gameState.currentPlayer];
    const space = BOARD_SPACES[player.position];
    
    addLog(`âŒ ${player.name} declined to buy ${space.name}`);
    document.getElementById('buyOptions').style.display = 'none';
    document.getElementById('statusMessage').textContent = 'Property skipped';
    
    setTimeout(() => endTurn(), 500);
}

function payRent(index) {
    const space = BOARD_SPACES[index];
    const payer = gameState.players[gameState.currentPlayer];
    const owner = gameState.players[space.owner];
    
    let rent = space.rent;
    
    if (space.type === 'property' && space.houses > 0) {
        rent = space.rentWithHouses[space.houses - 1];
    } else if (space.type === 'railroad') {
        const railCount = owner.properties.filter(p => BOARD_SPACES[p].type === 'railroad').length;
        rent = 25 * Math.pow(2, railCount - 1);
    } else if (space.type === 'utility') {
        const utilCount = owner.properties.filter(p => BOARD_SPACES[p].type === 'utility').length;
        const total = gameState.dice[0] + gameState.dice[1];
        rent = (utilCount === 1 ? 4 : 10) * total;
    }
    
    payer.cash -= rent;
    owner.cash += rent;
    
    playSound('rent');
    addLog(`ðŸ’° ${payer.name} paid $${rent} rent to ${owner.name}`);
    
    updateAllDisplays();
    
    setTimeout(() => endTurn(), 1500);
}

function drawCard(type) {
    const cards = type === 'chance' ? CHANCE_CARDS : COMMUNITY_CHEST_CARDS;
    const card = cards[Math.floor(Math.random() * cards.length)];
    const player = gameState.players[gameState.currentPlayer];
    
    const emoji = type === 'chance' ? 'ðŸŽ²' : 'ðŸ“‹';
    addLog(`${emoji} ${player.name} drew: ${card.name}`);
    
    switch(card.action) {
        case 'advanceGo':
            player.position = 0;
            player.cash += 200;
            updateTokens();
            break;
        case 'collect200':
        case 'collect100':
        case 'collect50':
        case 'collect25':
        case 'collect20':
        case 'collect10':
        case 'collect150':
        case 'inherit':
            const amount = parseInt(card.action.match(/\d+/) || ['100']);
            player.cash += amount;
            break;
        case 'pay50':
        case 'pay100':
        case 'pay15':
        case 'paySchool':
        case 'poorTax':
            const payAmount = parseInt(card.action.match(/\d+/) || ['50']);
            player.cash -= payAmount;
            break;
        case 'goJail':
            player.position = 10;
            updateTokens();
            break;
        case 'back3':
            player.position = (player.position - 3 + 40) % 40;
            updateTokens();
            break;
    }
    
    updateAllDisplays();
    
    setTimeout(() => endTurn(), 2000);
}

function endTurn() {
    gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
    gameState.canRoll = true;
    gameState.turnCount++;
    
    document.getElementById('rollDiceMainBtn').disabled = false;
    document.getElementById('buyOptions').style.display = 'none';
    
    const player = gameState.players[gameState.currentPlayer];
    document.getElementById('statusMessage').textContent = `${player.name}'s turn - Click to roll!`;
    
    updateCurrentSpaceInfo('Roll the dice to begin!');
    
    updateAllDisplays();
    addLog(`ðŸŽ¯ ${player.name}'s turn`);
    
    if (player.isAI && !gameState.aiThinking) {
        setTimeout(() => aiTakeTurn(), 1500);
    }
}

function updateAllDisplays() {
    updatePlayerCards();
    updateCurrentTurn();
    updateTokens();
    showSpaceInfo(gameState.players[gameState.currentPlayer].position);
}

function updatePlayerCards() {
    const container = document.getElementById('playerCards');
    container.innerHTML = '';
    
    gameState.players.forEach((player, i) => {
        const card = document.createElement('div');
        card.className = 'player-card';
        if (i === gameState.currentPlayer) {
            card.classList.add('active');
        }
        card.style.background = player.color;
        
        let propsHTML = '';
        if (player.properties.length > 0) {
            propsHTML = '<div class="property-grid">';
            player.properties.forEach(index => {
                const space = BOARD_SPACES[index];
                propsHTML += `<div class="property-item">${space.emoji} ${space.name} - $${space.price}</div>`;
            });
            propsHTML += '</div>';
        } else {
            propsHTML = '<div style="text-align: center; opacity: 0.7; margin-top: 10px;">No properties yet</div>';
        }
        
        card.innerHTML = `
            <div class="player-header">
                <div class="player-token-display">${player.token}</div>
                <div class="player-info">
                    <h3>${player.name}</h3>
                    <div class="player-cash">ðŸ’µ $${player.cash}</div>
                </div>
            </div>
            <div style="font-size: 14px; margin-bottom: 10px;">
                ðŸ  <strong>${player.properties.length}</strong> Properties
            </div>
            ${propsHTML}
        `;
        
        container.appendChild(card);
    });
}

function updateCurrentTurn() {
    const player = gameState.players[gameState.currentPlayer];
    
    document.getElementById('centerPlayerIcon').textContent = player.token;
    document.getElementById('centerPlayerIcon').style.background = `linear-gradient(135deg, ${player.color}, ${player.color}dd)`;
    document.getElementById('centerPlayerName').textContent = `${player.name}'s Turn`;
    document.getElementById('centerCash').textContent = `$${player.cash}`;
    document.getElementById('centerPosition').textContent = BOARD_SPACES[player.position].name;
    
    const lastRoll = gameState.dice[0] + gameState.dice[1];
    document.getElementById('centerLastRoll').textContent = lastRoll > 1 ? lastRoll : '-';
}

function addLog(message) {
    const logBox = document.getElementById('gameLogBox');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = message;
    
    logBox.insertBefore(entry, logBox.firstChild);
    
    while (logBox.children.length > 20) {
        logBox.removeChild(logBox.lastChild);
    }
}

function openTradeModal() {
    const player = gameState.players[gameState.currentPlayer];
    const modal = document.getElementById('tradeModal');
    const content = document.getElementById('tradeContent');
    
    let html = '';
    
    html += '<div class="section-title">ðŸ  Your Properties</div>';
    if (player.properties.length > 0) {
        html += '<div class="property-list">';
        player.properties.forEach(propIndex => {
            const space = BOARD_SPACES[propIndex];
            html += `
                <div class="property-trade-item">
                    <div class="property-trade-info">
                        <div class="property-trade-name">${space.emoji} ${space.name}</div>
                        <div class="property-trade-price">Value: $${space.price}</div>
                    </div>
                    <div class="trade-buttons">
                        <button class="trade-btn sell" onclick="openSellModal(${propIndex})">ðŸ’° Sell</button>
                    </div>
                </div>
            `;
        });
        html += '</div>';
    } else {
        html += '<div class="empty-state"><div class="empty-state-icon">ðŸšï¸</div><div>You don\'t own any properties yet</div></div>';
    }
    
    html += '<div class="section-divider"></div>';
    
    html += '<div class="section-title">ðŸ›’ Buy from Other Players</div>';
    let hasAvailableProperties = false;
    
    gameState.players.forEach((otherPlayer, index) => {
        if (index === gameState.currentPlayer) return;
        
        if (otherPlayer.properties.length > 0) {
            hasAvailableProperties = true;
            html += `
                <div class="player-properties-section">
                    <div class="player-badge" style="background: ${otherPlayer.color}; color: white;">
                        ${otherPlayer.token} ${otherPlayer.name}
                    </div>
                    <div class="property-list">
            `;
            
            otherPlayer.properties.forEach(propIndex => {
                const space = BOARD_SPACES[propIndex];
                html += `
                    <div class="property-trade-item">
                        <div class="property-trade-info">
                            <div class="property-trade-name">${space.emoji} ${space.name}</div>
                            <div class="property-trade-price">Price: $${space.price}</div>
                        </div>
                        <div class="trade-buttons">
                            <button class="trade-btn buy" onclick="buyFromPlayer(${propIndex}, ${index})">âœ… Buy</button>
                            <button class="trade-btn offer" onclick="openOfferModal(${propIndex}, ${index})">ðŸ“ Offer</button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div></div>';
        }
    });
    
    if (!hasAvailableProperties) {
        html += '<div class="empty-state"><div class="empty-state-icon">ðŸ“­</div><div>No properties available from other players</div></div>';
    }
    
    content.innerHTML = html;
    modal.classList.add('active');
}

function closeTradeModal() {
    document.getElementById('tradeModal').classList.remove('active');
}

function openSellModal(propertyIndex) {
    const space = BOARD_SPACES[propertyIndex];
    const modal = document.getElementById('sellModal');
    const content = document.getElementById('sellContent');
    
    const suggestedMin = Math.floor(space.price * 0.5);
    const suggestedMax = Math.floor(space.price * 1.5);
    
    content.innerHTML = `
        <div class="property-trade-item" style="margin-bottom: 20px;">
            <div class="property-trade-info">
                <div class="property-trade-name">${space.emoji} ${space.name}</div>
                <div class="property-trade-price">Original Price: $${space.price}</div>
                <div class="property-trade-price">Buildings: ${space.houses || 0} ðŸ </div>
            </div>
        </div>
        
        <div class="price-input-group">
            <label>ðŸ’µ Set Selling Price (MUST BE EVEN):</label>
            <input type="number" class="price-input" id="sellPrice" value="${space.price}" min="${suggestedMin}" max="9999" step="2">
            <div class="price-suggestion">Suggested: $${suggestedMin} - $${suggestedMax}</div>
            <div id="sellValidationMessage" style="margin-top: 8px;"></div>
        </div>
        
        <div style="background: #FEF3C7; border: 2px solid #F59E0B; padding: 15px; border-radius: 10px; margin: 15px 0;">
            <strong>âš ï¸ Rule:</strong> All trade prices must be EVEN numbers only!
        </div>
        
        <div class="modal-actions">
            <button class="modal-btn secondary" onclick="closeSellModal()">Cancel</button>
            <button class="modal-btn primary" id="confirmSellBtn" onclick="confirmSell(${propertyIndex})">ðŸ’° List for Sale</button>
        </div>
    `;
    
    setTimeout(() => {
        const priceInput = document.getElementById('sellPrice');
        const validationMsg = document.getElementById('sellValidationMessage');
        const confirmBtn = document.getElementById('confirmSellBtn');
        
        const validatePrice = () => {
            const value = parseInt(priceInput.value) || 0;
            if (value === 0) {
                validationMsg.innerHTML = '<div class="validation-error">âŒ Price cannot be $0!</div>';
                confirmBtn.disabled = true;
            } else if (value % 2 === 0) {
                validationMsg.innerHTML = '<div class="validation-success">âœ… Valid - Even number!</div>';
                confirmBtn.disabled = false;
            } else {
                validationMsg.innerHTML = '<div class="validation-error">âŒ Invalid - Must be EVEN!</div>';
                confirmBtn.disabled = true;
            }
        };
        
        priceInput.addEventListener('input', validatePrice);
        validatePrice();
    }, 100);
    
    modal.classList.add('active');
    closeTradeModal();
}

function closeSellModal() {
    document.getElementById('sellModal').classList.remove('active');
}

function confirmSell(propertyIndex) {
    let price = parseInt(document.getElementById('sellPrice').value);
    
    if (price % 2 !== 0) {
        alert('âŒ Trade validation failed: Price must be EVEN! (e.g., $100, $150, $200)\n\nYou entered: $' + price + ' (odd number)');
        return;
    }
    const space = BOARD_SPACES[propertyIndex];
    const player = gameState.players[gameState.currentPlayer];
    
    if (isNaN(price) || price <= 0) {
        alert('Please enter a valid price!');
        return;
    }
    
    gameState.tradeOffers.push({
        seller: gameState.currentPlayer,
        property: propertyIndex,
        price: price,
        type: 'sale'
    });
    
    addLog(`ðŸ’° ${player.name} listed ${space.name} for sale at $${price}`);
    playSound('buy');
    
    closeSellModal();
    openTradeModal();
}

function buyFromPlayer(propertyIndex, ownerIndex) {
    const space = BOARD_SPACES[propertyIndex];
    const buyer = gameState.players[gameState.currentPlayer];
    const seller = gameState.players[ownerIndex];
    
    const existingOffer = gameState.tradeOffers.find(o => o.property === propertyIndex && o.type === 'sale');
    const price = existingOffer ? existingOffer.price : space.price;
    
    if (price % 2 !== 0) {
        alert(`âŒ Trade validation: Price must be EVEN! Current price: $${price}`);
        return;
    }
    
    if (buyer.cash < price) {
        alert(`Not enough cash! You need $${price} but only have $${buyer.cash}`);
        return;
    }
    
    if (confirm(`Buy ${space.name} from ${seller.name} for $${price}?`)) {
        buyer.cash -= price;
        seller.cash += price;
        
        seller.properties = seller.properties.filter(p => p !== propertyIndex);
        buyer.properties.push(propertyIndex);
        space.owner = gameState.currentPlayer;
        
        gameState.tradeOffers = gameState.tradeOffers.filter(o => o.property !== propertyIndex);
        
        playSound('buy');
        addLog(`ðŸ¤ ${buyer.name} bought ${space.name} from ${seller.name} for $${price}`);
        
        updateAllDisplays();
        closeTradeModal();
    }
}

function openOfferModal(propertyIndex, ownerIndex) {
    const space = BOARD_SPACES[propertyIndex];
    const owner = gameState.players[ownerIndex];
    const player = gameState.players[gameState.currentPlayer];
    const modal = document.getElementById('offerModal');
    const content = document.getElementById('offerContent');
    
    let myPropsHTML = '<option value="">-- None --</option>';
    player.properties.forEach(propIndex => {
        const prop = BOARD_SPACES[propIndex];
        myPropsHTML += `<option value="${propIndex}">${prop.emoji} ${prop.name} ($${prop.price})</option>`;
    });
    
    content.innerHTML = `
        <div class="property-trade-item" style="margin-bottom: 20px;">
            <div class="property-trade-info">
                <div class="property-trade-name">You want: ${space.emoji} ${space.name}</div>
                <div class="property-trade-price">Owner: ${owner.token} ${owner.name}</div>
                <div class="property-trade-price">Value: $${space.price}</div>
            </div>
        </div>
        
        <div class="section-title">ðŸ“¦ Your Offer</div>
        
        <div class="price-input-group">
            <label>ðŸ  Property (Optional):</label>
            <select class="price-input" id="offerProperty">${myPropsHTML}</select>
        </div>
        
        <div class="price-input-group">
            <label>ðŸ’µ Cash Amount (MUST BE EVEN):</label>
            <input type="number" class="price-input" id="offerCash" value="0" min="0" max="${player.cash}" step="2">
            <div class="price-suggestion">You have: $${player.cash}</div>
            <div id="validationMessage" style="margin-top: 8px;"></div>
        </div>
        
        <div style="background: #FEF3C7; border: 2px solid #F59E0B; padding: 15px; border-radius: 10px; margin: 15px 0;">
            <strong>âš ï¸ Important:</strong> Cash amount must be EVEN (e.g., $100, $150, $200)<br>
            <span style="color: #DC2626;">âŒ ODD numbers not allowed (e.g., $101, $125)</span>
        </div>
        
        <div class="modal-actions">
            <button class="modal-btn secondary" onclick="closeOfferModal()">Cancel</button>
            <button class="modal-btn primary" id="sendOfferBtn" onclick="sendOffer(${propertyIndex}, ${ownerIndex})">ðŸ“¨ Send Offer</button>
        </div>
    `;
    
    setTimeout(() => {
        const cashInput = document.getElementById('offerCash');
        const validationMsg = document.getElementById('validationMessage');
        const sendBtn = document.getElementById('sendOfferBtn');
        
        cashInput.addEventListener('input', () => {
            const value = parseInt(cashInput.value) || 0;
            if (value === 0) {
                validationMsg.innerHTML = '';
                sendBtn.disabled = false;
            } else if (value % 2 === 0) {
                validationMsg.innerHTML = '<div class="validation-success">âœ… Valid - Even number!</div>';
                sendBtn.disabled = false;
            } else {
                validationMsg.innerHTML = '<div class="validation-error">âŒ Invalid - Must be EVEN!</div>';
                sendBtn.disabled = true;
            }
        });
    }, 100);
    
    modal.classList.add('active');
    closeTradeModal();
}

function closeOfferModal() {
    document.getElementById('offerModal').classList.remove('active');
}

function sendOffer(propertyIndex, ownerIndex) {
    const offerProp = document.getElementById('offerProperty').value;
    let offerCash = parseInt(document.getElementById('offerCash').value) || 0;
    
    if (offerCash % 2 !== 0) {
        alert('âŒ Trade validation failed: Cash amount must be EVEN! (e.g., $100, $150, $200)\n\nYou entered: $' + offerCash + ' (odd number)');
        return;
    }
    const buyer = gameState.players[gameState.currentPlayer];
    const seller = gameState.players[ownerIndex];
    const space = BOARD_SPACES[propertyIndex];
    
    if (!offerProp && offerCash === 0) {
        alert('Please offer something!');
        return;
    }
    
    if (offerCash > buyer.cash) {
        alert('Not enough cash!');
        return;
    }
    
    let offerText = '';
    if (offerProp) {
        const propSpace = BOARD_SPACES[parseInt(offerProp)];
        offerText = `${propSpace.name}`;
    }
    if (offerCash > 0) {
        offerText += (offerText ? ' + ' : '') + `$${offerCash}`;
    }
    
    if (confirm(`Offer ${offerText} to ${seller.name} for ${space.name}?`)) {
        gameState.tradeOffers.push({
            buyer: gameState.currentPlayer,
            seller: ownerIndex,
            wantedProperty: propertyIndex,
            offeredProperty: offerProp ? parseInt(offerProp) : null,
            offeredCash: offerCash,
            type: 'offer'
        });
        
        addLog(`ðŸ“ ${buyer.name} made an offer to ${seller.name} for ${space.name}`);
        playSound('buy');
        
        closeOfferModal();
        
        setTimeout(() => {
            if (confirm(`${seller.name} received your offer. Accept it automatically?`)) {
                acceptOffer(gameState.tradeOffers.length - 1);
            }
        }, 1000);
    }
}

function acceptOffer(offerIndex) {
    const offer = gameState.tradeOffers[offerIndex];
    if (!offer) return;
    
    const buyer = gameState.players[offer.buyer];
    const seller = gameState.players[offer.seller];
    const wantedSpace = BOARD_SPACES[offer.wantedProperty];
    
    if (offer.offeredCash > 0) {
        buyer.cash -= offer.offeredCash;
        seller.cash += offer.offeredCash;
    }
    
    if (offer.offeredProperty !== null) {
        const offeredSpace = BOARD_SPACES[offer.offeredProperty];
        buyer.properties = buyer.properties.filter(p => p !== offer.offeredProperty);
        seller.properties.push(offer.offeredProperty);
        offeredSpace.owner = offer.seller;
    }
    
    seller.properties = seller.properties.filter(p => p !== offer.wantedProperty);
    buyer.properties.push(offer.wantedProperty);
    wantedSpace.owner = offer.buyer;
    
    addLog(`âœ… Trade completed! ${buyer.name} got ${wantedSpace.name}`);
    playSound('buy');
    
    gameState.tradeOffers.splice(offerIndex, 1);
    updateAllDisplays();
}

function aiTakeTurn() {
    if (gameState.aiThinking) return;
    
    const player = gameState.players[gameState.currentPlayer];
    if (!player.isAI) return;
    
    gameState.aiThinking = true;
    document.getElementById('rollDiceMainBtn').disabled = true;
    document.getElementById('statusMessage').textContent = `${player.name} is thinking...`;
    
    setTimeout(() => {
        rollDice();
    }, 1000 + Math.random() * 1000);
}

function aiDecideBuy(spaceIndex) {
    const player = gameState.players[gameState.currentPlayer];
    const space = BOARD_SPACES[spaceIndex];
    const difficulty = gameState.settings.aiDifficulty;
    
    let shouldBuy = false;
    
    if (difficulty === 'easy') {
        shouldBuy = Math.random() > 0.5;
    } else if (difficulty === 'medium') {
        const affordability = player.cash / space.price;
        shouldBuy = affordability > 3 && space.price < 250;
    } else if (difficulty === 'hard') {
        const affordability = player.cash / space.price;
        const hasColorMatch = player.properties.some(p => BOARD_SPACES[p].color === space.color);
        shouldBuy = affordability > 2.5 && (space.price < 300 || hasColorMatch);
    }
    
    setTimeout(() => {
        if (shouldBuy && player.cash >= space.price) {
            buyProperty(spaceIndex);
        } else {
            skipProperty();
        }
        gameState.aiThinking = false;
    }, 800);
}

function openSaveModal() {
    const modal = document.getElementById('saveModal');
    const content = document.getElementById('saveContent');
    
    const playtime = Math.floor((Date.now() - gameState.gameStartTime) / 1000);
    const minutes = Math.floor(playtime / 60);
    
    let html = `
        <div style="background: var(--color-bg); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: var(--color-primary);">Current Game Status</h3>
            <div class="detail-row"><span>Players:</span><span>${gameState.players.length} (${gameState.humanCount} Human, ${gameState.aiPlayers.length} AI)</span></div>
            <div class="detail-row"><span>Turn:</span><span>${gameState.players[gameState.currentPlayer].name} (Round ${Math.floor(gameState.turnCount / gameState.players.length) + 1})</span></div>
            <div class="detail-row"><span>Playtime:</span><span>${minutes} minutes</span></div>
        </div>
        
        <h4 style="margin: 0 0 15px 0;">Choose Save Slot:</h4>
        <div style="display: flex; flex-direction: column; gap: 10px;">
    `;
    
    for (let i = 1; i <= 5; i++) {
        const saved = getSavedGame(i);
        if (saved) {
            const date = new Date(saved.timestamp);
            html += `
                <button class="trade-btn offer" onclick="saveGameToSlot(${i})" style="width: 100%; padding: 15px; text-align: left;">
                    <div><strong>Slot ${i}:</strong> ${saved.saveName}</div>
                    <div style="font-size: 12px; opacity: 0.8;">${date.toLocaleString()} | ${saved.minutes} min</div>
                </button>
            `;
        } else {
            html += `
                <button class="trade-btn buy" onclick="saveGameToSlot(${i})" style="width: 100%; padding: 15px;">
                    Slot ${i}: Empty
                </button>
            `;
        }
    }
    
    html += `
        </div>
        <div class="modal-actions" style="margin-top: 20px;">
            <button class="modal-btn secondary" onclick="closeSaveModal()">Cancel</button>
        </div>
    `;
    
    content.innerHTML = html;
    modal.classList.add('active');
}

function closeSaveModal() {
    document.getElementById('saveModal').classList.remove('active');
}

function saveGameToSlot(slot) {
    const playtime = Math.floor((Date.now() - gameState.gameStartTime) / 1000);
    const saveData = {
        slot: slot,
        saveName: `Game ${slot}`,
        timestamp: Date.now(),
        minutes: Math.floor(playtime / 60),
        gameState: JSON.parse(JSON.stringify(gameState)),
        boardState: JSON.parse(JSON.stringify(BOARD_SPACES))
    };
    
    if (!window.monopolySaves) window.monopolySaves = {};
    window.monopolySaves[`slot${slot}`] = saveData;
    
    addLog(`ðŸ’¾ Game saved to Slot ${slot}!`);
    playSound('buy');
    closeSaveModal();
    alert(`Game saved successfully to Slot ${slot}!`);
}

function getSavedGame(slot) {
    if (!window.monopolySaves) return null;
    return window.monopolySaves[`slot${slot}`] || null;
}

function openLoadModal() {
    const modal = document.getElementById('loadModal');
    const content = document.getElementById('loadContent');
    
    let html = '<h4 style="margin: 0 0 15px 0;">Saved Games:</h4>';
    html += '<div style="display: flex; flex-direction: column; gap: 12px;">';
    
    let hasSaves = false;
    for (let i = 1; i <= 5; i++) {
        const saved = getSavedGame(i);
        if (saved) {
            hasSaves = true;
            const date = new Date(saved.timestamp);
            html += `
                <div style="background: var(--color-bg); padding: 15px; border-radius: 12px; border: 2px solid var(--color-border);">
                    <div style="font-weight: bold; margin-bottom: 8px;">Slot ${i}: ${saved.saveName}</div>
                    <div style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: 10px;">
                        ${date.toLocaleString()} | ${saved.minutes} min played
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="trade-btn buy" onclick="loadGameFromSlot(${i})" style="flex: 1;">Load</button>
                        <button class="trade-btn sell" onclick="deleteSaveSlot(${i})" style="flex: 1;">Delete</button>
                    </div>
                </div>
            `;
        } else {
            html += `
                <div style="background: var(--color-bg); padding: 15px; border-radius: 12px; border: 2px dashed var(--color-border); opacity: 0.5;">
                    <div>Slot ${i}: (Empty)</div>
                </div>
            `;
        }
    }
    
    html += '</div>';
    
    if (!hasSaves) {
        html = '<div class="empty-state"><div class="empty-state-icon">ðŸ“‚</div><div>No saved games found</div></div>';
    }
    
    html += '<div class="modal-actions" style="margin-top: 20px;"><button class="modal-btn secondary" onclick="closeLoadModal()">Cancel</button></div>';
    
    content.innerHTML = html;
    modal.classList.add('active');
}

function closeLoadModal() {
    document.getElementById('loadModal').classList.remove('active');
}

function loadGameFromSlot(slot) {
    const saved = getSavedGame(slot);
    if (!saved) return;
    
    if (confirm(`Load game from Slot ${slot}? Current game will be lost.`)) {
        gameState = saved.gameState;
        
        saved.boardState.forEach((space, i) => {
            BOARD_SPACES[i].owner = space.owner;
            BOARD_SPACES[i].houses = space.houses || 0;
        });
        
        closeLoadModal();
        updateAllDisplays();
        updateCurrentTurn();
        addLog(`ðŸ“‚ Game loaded from Slot ${slot}!`);
        playSound('buy');
        
        const player = gameState.players[gameState.currentPlayer];
        if (player.isAI && gameState.canRoll) {
            setTimeout(() => aiTakeTurn(), 1000);
        }
    }
}

function deleteSaveSlot(slot) {
    if (confirm(`Delete save from Slot ${slot}?`)) {
        if (!window.monopolySaves) window.monopolySaves = {};
        delete window.monopolySaves[`slot${slot}`];
        openLoadModal();
    }
}

function openSettingsModal() {
    const modal = document.getElementById('settingsModal');
    const content = document.getElementById('settingsContent');
    
    const settings = gameState.settings;
    
    content.innerHTML = `
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <div>
                <h4 style="color: var(--color-primary); margin: 0 0 12px 0;">ðŸŽ® Game Settings</h4>
                <div class="checkbox-group">
                    <input type="checkbox" id="settingShowValues" ${settings.showPropertyValues ? 'checked' : ''}>
                    <label for="settingShowValues">Show Property Values on Board</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="settingShowRents" ${settings.showRentAmounts ? 'checked' : ''}>
                    <label for="settingShowRents">Show Rent Amounts</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="settingConfirmSell" ${settings.confirmBeforeSelling ? 'checked' : ''}>
                    <label for="settingConfirmSell">Confirm Before Selling</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="settingConfirmTrade" ${settings.confirmBeforeTrading ? 'checked' : ''}>
                    <label for="settingConfirmTrade">Confirm Before Trading</label>
                </div>
            </div>
            
            <div>
                <h4 style="color: var(--color-primary); margin: 0 0 12px 0;">ðŸ”Š Audio Settings</h4>
                <div class="checkbox-group">
                    <input type="checkbox" id="settingBgMusic" ${settings.bgMusic ? 'checked' : ''}>
                    <label for="settingBgMusic">ðŸŽµ Background Music</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="settingSoundFx" ${settings.soundEffects ? 'checked' : ''}>
                    <label for="settingSoundFx">ðŸ”Š Sound Effects</label>
                </div>
                <div class="volume-control">
                    <label>ðŸ”Š Volume:</label>
                    <input type="range" class="volume-slider" id="settingVolume" min="0" max="100" value="${settings.volume * 100}">
                    <span class="volume-value" id="settingVolumeValue">${Math.floor(settings.volume * 100)}%</span>
                </div>
            </div>
            
            <div>
                <h4 style="color: var(--color-primary); margin: 0 0 12px 0;">ðŸŽ¨ Appearance</h4>
                <div style="margin-bottom: 10px;">Theme:</div>
                <select class="price-input" id="settingTheme">
                    <option value="royal">ðŸ‘‘ Royal Blue</option>
                    <option value="forest">ðŸŒ² Forest Green</option>
                    <option value="sunset">ðŸŒ… Sunset Orange</option>
                    <option value="midnight">ðŸŒ™ Midnight Purple</option>
                    <option value="ocean">ðŸŒŠ Ocean Teal</option>
                    <option value="sakura">ðŸŒ¸ Sakura Pink</option>
                    <option value="cyber">ðŸ”® Cyber Neon</option>
                    <option value="classic">ðŸŽ² Classic</option>
                </select>
            </div>
            
            <div>
                <h4 style="color: var(--color-primary); margin: 0 0 12px 0;">ðŸ¤– AI Settings</h4>
                <div style="margin-bottom: 10px;">Difficulty:</div>
                <div style="display: flex; gap: 8px;">
                    <button class="trade-btn ${settings.aiDifficulty === 'easy' ? 'offer' : 'buy'}" onclick="updateAIDifficulty('easy')" style="flex: 1;">ðŸ˜Š Easy</button>
                    <button class="trade-btn ${settings.aiDifficulty === 'medium' ? 'offer' : 'buy'}" onclick="updateAIDifficulty('medium')" style="flex: 1;">ðŸŽ¯ Medium</button>
                    <button class="trade-btn ${settings.aiDifficulty === 'hard' ? 'offer' : 'buy'}" onclick="updateAIDifficulty('hard')" style="flex: 1;">ðŸ”¥ Hard</button>
                </div>
            </div>
        </div>
        
        <div class="modal-actions" style="margin-top: 20px;">
            <button class="modal-btn secondary" onclick="closeSettingsModal()">Cancel</button>
            <button class="modal-btn primary" onclick="applySettings()">âœ… Apply</button>
        </div>
    `;
    
    document.getElementById('settingTheme').value = settings.theme;
    
    document.getElementById('settingVolume').addEventListener('input', (e) => {
        document.getElementById('settingVolumeValue').textContent = e.target.value + '%';
    });
    
    modal.classList.add('active');
}

function closeSettingsModal() {
    document.getElementById('settingsModal').classList.remove('active');
}

function updateAIDifficulty(difficulty) {
    gameState.settings.aiDifficulty = difficulty;
    openSettingsModal();
}

function applySettings() {
    const settings = gameState.settings;
    
    settings.showPropertyValues = document.getElementById('settingShowValues').checked;
    settings.showRentAmounts = document.getElementById('settingShowRents').checked;
    settings.confirmBeforeSelling = document.getElementById('settingConfirmSell').checked;
    settings.confirmBeforeTrading = document.getElementById('settingConfirmTrade').checked;
    settings.bgMusic = document.getElementById('settingBgMusic').checked;
    settings.soundEffects = document.getElementById('settingSoundFx').checked;
    settings.volume = parseInt(document.getElementById('settingVolume').value) / 100;
    settings.theme = document.getElementById('settingTheme').value;
    
    document.body.setAttribute('data-theme', settings.theme);
    document.getElementById('themeSelect').value = settings.theme;
    
    if (settings.bgMusic) {
        startMusic();
    } else {
        stopMusic();
    }
    
    gameState.players.forEach((player, i) => {
        if (player.isAI) {
            player.name = `AI ${gameState.aiPlayers.indexOf(i) + 1} (${settings.aiDifficulty})`;
        }
    });
    
    updateAllDisplays();
    closeSettingsModal();
    addLog('âš™ï¸ Settings applied!');
}

function showSpaceInfoModal(index) {
    const space = BOARD_SPACES[index];
    const modal = document.getElementById('stateInfoModal');
    const content = document.getElementById('stateInfoContent');
    
    document.getElementById('stateInfoTitle').textContent = `${space.emoji} ${space.name}`;
    
    let html = '';
    
    if (space.type === 'property') {
        const owner = space.owner >= 0 ? gameState.players[space.owner].name : 'Available';
        const ownerColor = space.owner >= 0 ? gameState.players[space.owner].color : '#6B7280';
        
        html = `
            <div style="background: var(--color-bg); padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <h4 style="color: var(--color-primary); margin: 0 0 15px 0;">ðŸ“ Location Info</h4>
                <div class="detail-row"><span>Region:</span><span>${space.region || 'India'}</span></div>
                <div class="detail-row"><span>Capital:</span><span>${space.capital || 'N/A'}</span></div>
                <div class="detail-row"><span>Type:</span><span>Property</span></div>
            </div>
            
            <div style="background: var(--color-bg); padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <h4 style="color: var(--color-primary); margin: 0 0 15px 0;">ðŸŽ® Monopoly Details</h4>
                <div class="detail-row"><span>Purchase Price:</span><span style="font-weight: bold; color: var(--color-primary);">$${space.price}</span></div>
                <div class="detail-row"><span>Owner:</span><span style="color: ${ownerColor}; font-weight: bold;">${owner}</span></div>
                <div class="detail-row"><span>Buildings:</span><span>${space.houses || 0} ðŸ </span></div>
                <div class="detail-row"><span>Current Rent:</span><span>$${space.houses > 0 ? space.rentWithHouses[(space.houses || 1) - 1] : space.rent}</span></div>
            </div>
            
            <div style="background: var(--color-bg); padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <h4 style="color: var(--color-primary); margin: 0 0 15px 0;">ðŸ’° Rent Breakdown</h4>
                <div class="detail-row"><span>Unbuilt:</span><span>$${space.rent}</span></div>
                <div class="detail-row"><span>1 House:</span><span>$${space.rentWithHouses[0]}</span></div>
                <div class="detail-row"><span>2 Houses:</span><span>$${space.rentWithHouses[1]}</span></div>
                <div class="detail-row"><span>3 Houses:</span><span>$${space.rentWithHouses[2]}</span></div>
                <div class="detail-row"><span>4 Houses:</span><span>$${space.rentWithHouses[3]}</span></div>
                <div class="detail-row"><span>Hotel:</span><span>$${space.rentWithHouses[4]}</span></div>
            </div>
            
            <div style="background: var(--color-bg); padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <h4 style="color: var(--color-primary); margin: 0 0 15px 0;">ðŸ—ï¸ Building Info</h4>
                <div class="detail-row"><span>House Cost:</span><span>$${space.houseCost}</span></div>
                <div class="detail-row"><span>Hotel Cost:</span><span>$${space.houseCost * 4}</span></div>
            </div>
            
            <div style="background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark)); color: white; padding: 15px; border-radius: 12px;">
                <h4 style="margin: 0 0 10px 0;">ðŸ’¡ Strategy Tip</h4>
                <p style="margin: 0; line-height: 1.6; font-size: 14px;">
                    Own all properties of the same color to build houses and increase rent significantly!
                    ${space.region === 'South' ? ' Southern states are valuable!' : ''}
                    ${space.price < 150 ? ' Affordable starter property!' : ' Premium property with high returns!'}
                </p>
            </div>
        `;
    } else if (space.type === 'railroad') {
        const owner = space.owner >= 0 ? gameState.players[space.owner].name : 'Available';
        html = `
            <div style="background: var(--color-bg); padding: 20px; border-radius: 12px;">
                <h4 style="color: var(--color-primary); margin: 0 0 15px 0;">ðŸš‚ Railroad Details</h4>
                <div class="detail-row"><span>Type:</span><span>Railroad</span></div>
                <div class="detail-row"><span>Price:</span><span>$${space.price}</span></div>
                <div class="detail-row"><span>Base Rent:</span><span>$${space.rent}</span></div>
                <div class="detail-row"><span>Owner:</span><span>${owner}</span></div>
                <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 8px;">
                    <strong>ðŸ’¡ Tip:</strong> Rent doubles with each additional railroad owned!
                </div>
            </div>
        `;
    } else {
        html = `
            <div style="background: var(--color-bg); padding: 20px; border-radius: 12px; text-align: center;">
                <div style="font-size: 48px; margin-bottom: 15px;">${space.emoji}</div>
                <h4 style="color: var(--color-primary); margin: 0 0 10px 0;">${space.name}</h4>
                <p style="color: var(--color-text-secondary);">Special space</p>
            </div>
        `;
    }
    
    content.innerHTML = html;
    modal.classList.add('active');
}

function closeStateInfoModal() {
    document.getElementById('stateInfoModal').classList.remove('active');
}

window.addEventListener('DOMContentLoaded', initSetup);
    </script>
</body>
</html>